<div id="propertiesDiv">
    <h4>Properties</h4>
    <div *ngIf="elt.properties.length === 0">There are no properties.</div>
    <ng-container *ngFor="let prop of elt.properties;let i = index">
        <dl class="row">
            <dt class="col-3 text-right">
                <ng-container *ngIf="canEdit && prop.edit">Confirm Delete
                    <mat-icon (click)="removePropertyByIndex(i)" id="confirmRemoveProperty-{{i}}">check</mat-icon>
                    <mat-icon (click)="prop.edit = false" id="cancelRemoveProperty-{{i}}">cancel</mat-icon>
                </ng-container>
                <mat-icon (click)="prop.edit = true" *ngIf="canEdit && !prop.edit"
                      id="removeProperty-{{i}}">delete</mat-icon>
                <cde-sortable-array [theArray]="elt.properties" [index]="i" *ngIf="canEdit"
                                    (cb)="onEltChange.emit()"></cde-sortable-array>
                Key:
            </dt>
            <dd id="key_{{i}}" class="col-9">{{prop.key}}</dd>
            <dt class="col-3 text-right">Id:</dt>
            <dd id="value_{{i}}" class="col-9">
                <cde-inline-area-edit [(model)]="prop.value" (modelChange)="onEltChange.emit()"
                                      [(defFormat)]="prop.valueFormat"
                                      [isAllowed]="canEdit"></cde-inline-area-edit>
            </dd>
        </dl>
        <hr>
    </ng-container>
    <button *ngIf="canEdit && onInitDone" id="openNewPropertyModalBtn" mat-raised-button (click)="openNewPropertyModal()">
        <mat-icon>add</mat-icon> Add Property
    </button>
</div>

<ng-template #newPropertyContent id="newPropertyModal" let-c="close" let-d="dismiss">
    <div class="modal-header" id="newPropertyModalHeader">
        <h4 class="modal-title">Add Property</h4>
    </div>
    <form role="form" #newPropertyForm="ngForm" (ngSubmit)="addNewProperty()">
        <div class="modal-body" id="newPropertyModalBody">
            <div class="form-group">
                <label for="newKey">Key</label>
                <select class="form-control" id="newKey" name="newKey" [(ngModel)]="newProperty.key" required>
                    <option *ngFor="let key of orgPropertyKeys;" value="{{key}}">{{key}}</option>
                </select>
            </div>
            <div class="form-group">
                <label for="newValue">Value</label>
                <div id="newValue">
                    <button mat-raised-button (click)="newProperty.valueFormat = ''" type="button">Plain Text</button>
                    <button mat-raised-button (click)="newProperty.valueFormat = 'html'" type="button">Rich Text</button>
                    <textarea name="definition" *ngIf="newProperty.valueFormat !== 'html'"
                              [(ngModel)]="newProperty.value" class="form-control" Placeholder="Property Value"
                              required></textarea>
                    <ckeditor name="definition" *ngIf="newProperty.valueFormat === 'html'"
                              [config]="{extraPlugins: 'divarea'}" [(ngModel)]="newProperty.value"
                              Placeholder="Property Value">
                    </ckeditor>
                </div>
            </div>
            <div class="alert alert-info">
                Property keys are managed in Org Management > List Management
            </div>
        </div>
        <div class="modal-footer" id="newPropertyModalFooter">
            <button (click)="c('Close click')" id="cancelNewPropertyBtn" mat-raised-button>Cancel</button>
            <button [disabled]="!newPropertyForm.form.valid" id="createNewPropertyBtn" mat-raised-button color="primary"
                    type="submit">Save</button>
        </div>
    </form>
</ng-template>
