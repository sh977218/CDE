var path = require('path');

var express = require('express')
    , https = require('https')
    , fs = require('fs')
    , config = require('../../../system/node-js/parseConfig')
    , bodyParser = require('body-parser')
    , cookieParser = require('cookie-parser')
    , session = require('express-session')
    , methodOverride = require('method-override')
    , morganLogger = require('morgan')
    ;

var app = express();

// all environments
app.set('port', config.vsac.port || 4000);
app.set('views', __dirname + '/views');
app.set('view engine', 'ejs');
app.use(morganLogger('dev'));
app.use(bodyParser.json());
app.use(methodOverride());
app.use(cookieParser('your secret here'));
app.use(session({ secret: 'omgnodeworks', resave: false, saveUninitialized: false}));

app.get('/vsac/ws/Ticket', function(req, res) {
    res.send("MOCKticket.");
});

app.post('/vsac/ws/Ticket', function(req, res) {
    res.send("MOCKticket.");
});

app.post('/vsac/ws/Ticket/:ticketId', function(req, res) {
    res.send("MOCKticket.");
});

app.get('/vsac/ws/RetrieveValueSet', function(req, res) {
    var key = req.query['id'];
    if (!fs.existsSync(path.join(__dirname, './vsac-data/' + key))) {
        res.status(404).send("The requested resource () is not available.");
    } else {
        fs.readFile(path.join(__dirname, './vsac-data/' + key), function(err, data) {
            if (err) {
                res.send("file is corrupt");
            } else {
                res.send(data);
            }
        });
    }
});

var umlsSearches = {
    "female": {"pageSize":25,"pageNumber":1,"result":{"classType":"searchResults","results":[{"ui":"C0015780","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","name":"Female"},{"ui":"C0043210","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0043210","name":"Woman"},{"ui":"C0086287","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0086287","name":"Females"},{"ui":"C1705497","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C1705497","name":"Female, Self-Report"},{"ui":"C1705498","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C1705498","name":"Female Phenotype"},{"ui":"C0001588","rootSource":"MSH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0001588","name":"Adolescents, Female"},{"ui":"C0009873","rootSource":"MSH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0009873","name":"Contraceptive Agents, Female"},{"ui":"C0013394","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0013394","name":"Dyspareunia (female)"},{"ui":"C0015785","rootSource":"MSH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015785","name":"Inhibins, Female"},{"ui":"C0015787","rootSource":"MSH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015787","name":"Female Sterilization"},{"ui":"C0017421","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0017421","name":"Female genitalia"},{"ui":"C0021361","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0021361","name":"Female infertility"},{"ui":"C0025320","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0025320","name":"Menopause"},{"ui":"C0029936","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0029936","name":"Ovariectomy"},{"ui":"C0029939","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0029939","name":"Ovary"},{"ui":"C0029974","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0029974","name":"Ovum"},{"ui":"C0032961","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0032961","name":"Pregnancy"},{"ui":"C0033011","rootSource":"MSH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0033011","name":"Pregnant Women"},{"ui":"C0042993","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0042993","name":"Vulva"},{"ui":"C0079341","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0079341","name":"Female Circumcision"},{"ui":"C0086286","rootSource":"MSH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0086286","name":"Female Contraception"},{"ui":"C0150905","rootSource":"CHV","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0150905","name":"patient is female"},{"ui":"C0151752","rootSource":"MDR","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0151752","name":"Female lactation"},{"ui":"C0156419","rootSource":"SNOMEDCT_US","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0156419","name":"Female hematocele"},{"ui":"C0194606","rootSource":"SNOMEDCT_US","uri":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0194606","name":"Female urethrorrhaphy"}]}}
};

var umlsAtoms = {
    "C0015780": {
        "NCI": {"pageSize":500,"pageNumber":1,"pageCount":1,"result":[{"classType":"Atom","ui":"A10768999","suppressible":"false","obsolete":"false","rootSource":"NCI","termType":"AB","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C16576","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C16576","sourceDescriptor":"NONE","attributes":"NONE","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"F","language":"ENG"},{"classType":"Atom","ui":"A10760885","suppressible":"false","obsolete":"false","rootSource":"NCI","termType":"SY","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C46110","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C46110","sourceDescriptor":"NONE","attributes":"NONE","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female","language":"ENG"},{"classType":"Atom","ui":"A7570536","suppressible":"false","obsolete":"false","rootSource":"NCI","termType":"PT","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C16576","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C16576","sourceDescriptor":"NONE","attributes":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A7570536/attributes","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A7570536/relations","definitions":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A7570536/definitions","name":"Female","language":"ENG"},{"classType":"Atom","ui":"A23970988","suppressible":"false","obsolete":"false","rootSource":"NCI","termType":"SY","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/TCGA","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C16576","sourceDescriptor":"NONE","attributes":"NONE","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female","language":"ENG"},{"classType":"Atom","ui":"A23887023","suppressible":"false","obsolete":"false","rootSource":"NCI","termType":"SY","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/NHIS","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C16576","sourceDescriptor":"NONE","attributes":"NONE","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female","language":"ENG"},{"classType":"Atom","ui":"A10805032","suppressible":"false","obsolete":"false","rootSource":"NCI","termType":"PT","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C46110","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C46110","sourceDescriptor":"NONE","attributes":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A10805032/attributes","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A10805032/definitions","name":"Female Gender","language":"ENG"},{"classType":"Atom","ui":"A10805031","suppressible":"false","obsolete":"false","rootSource":"NCI","termType":"SY","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C46110","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C46110","sourceDescriptor":"NONE","attributes":"NONE","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female Gender, Self Report","language":"ENG"},{"classType":"Atom","ui":"A10805030","suppressible":"false","obsolete":"false","rootSource":"NCI","termType":"SY","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C46110","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/NCI/C46110","sourceDescriptor":"NONE","attributes":"NONE","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female Gender, Self Reported","language":"ENG"}]},
        "LNC": {"pageSize":500,"pageNumber":1,"pageCount":1,"result":[{"classType":"Atom","ui":"A24095561","suppressible":"false","obsolete":"false","rootSource":"LNC","termType":"LA","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/LNC/LA3-6","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/LNC/LA3-6","sourceDescriptor":"NONE","attributes":"NONE","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female","language":"ENG"}]},
        "SNOMEDCT_US": {"pageSize":500,"pageNumber":1,"pageCount":1,"result":[{"classType":"Atom","ui":"A2881557","suppressible":"false","obsolete":"false","rootSource":"SNOMEDCT_US","termType":"PT","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/248152002","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/248152002","sourceDescriptor":"NONE","attributes":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A2881557/attributes","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female","language":"ENG"},{"classType":"Atom","ui":"A2881558","suppressible":"false","obsolete":"false","rootSource":"SNOMEDCT_US","termType":"SY","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/1086007","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/1086007","sourceDescriptor":"NONE","attributes":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A2881558/attributes","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female","language":"ENG"},{"classType":"Atom","ui":"A3453091","suppressible":"false","obsolete":"false","rootSource":"SNOMEDCT_US","termType":"FN","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/248152002","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/248152002","sourceDescriptor":"NONE","attributes":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A3453091/attributes","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female (finding)","language":"ENG"},{"classType":"Atom","ui":"A2877558","suppressible":"false","obsolete":"false","rootSource":"SNOMEDCT_US","termType":"SY","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/1086007","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/1086007","sourceDescriptor":"NONE","attributes":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A2877558/attributes","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female individual","language":"ENG"},{"classType":"Atom","ui":"A3453356","suppressible":"false","obsolete":"false","rootSource":"SNOMEDCT_US","termType":"PT","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/1086007","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/1086007","sourceDescriptor":"NONE","attributes":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A3453356/attributes","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female structure","language":"ENG"},{"classType":"Atom","ui":"A3453355","suppressible":"false","obsolete":"false","rootSource":"SNOMEDCT_US","termType":"FN","code":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/1086007","concept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/CUI/C0015780","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/source/SNOMEDCT_US/1086007","sourceDescriptor":"NONE","attributes":"https://uts-ws.nlm.nih.gov/rest/content/2015AB/AUI/A3453355/attributes","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"Female structure (body structure)","language":"ENG"}]}
    },
    "C1515945": {
        "SNOMEDCT_US": {"pageSize":500,"pageNumber":1,"pageCount":1,"result":[{"classType":"Atom","ui":"A7879317","suppressible":"false","obsolete":"false","rootSource":"SNOMEDCT_US","termType":"PT","code":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/source/SNOMEDCT_US/413490006","concept":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/CUI/C1515945","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/source/SNOMEDCT_US/413490006","sourceDescriptor":"NONE","attributes":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/AUI/A7879317/attributes","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"American Indian or Alaska native","language":"ENG"},{"classType":"Atom","ui":"A7879314","suppressible":"false","obsolete":"false","rootSource":"SNOMEDCT_US","termType":"FN","code":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/source/SNOMEDCT_US/413490006","concept":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/CUI/C1515945","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/source/SNOMEDCT_US/413490006","sourceDescriptor":"NONE","attributes":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/AUI/A7879314/attributes","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"American Indian or Alaska native (racial group)","language":"ENG"}]},
        "LNC": {"pageSize":500,"pageNumber":1,"pageCount":1,"result":[{"classType":"Atom","ui":"A24098846","suppressible":"false","obsolete":"false","rootSource":"LNC","termType":"LA","code":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/source/LNC/LA10608-0","concept":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/CUI/C1515945","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/source/LNC/LA10608-0","sourceDescriptor":"NONE","attributes":"NONE","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"American Indian or Alaska Native","language":"ENG"},{"classType":"Atom","ui":"A24101524","suppressible":"false","obsolete":"false","rootSource":"LNC","termType":"LA","code":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/source/LNC/LA6155-1","concept":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/CUI/C1515945","sourceConcept":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/source/LNC/LA6155-1","sourceDescriptor":"NONE","attributes":"NONE","parents":"NONE","ancestors":null,"children":"NONE","descendants":null,"relations":"NONE","definitions":"NONE","name":"American Indian or Alaska Native","language":"ENG"}]}
    }
};

var umlsFromSrc = {
    "c41259": {"pageSize":25,"pageNumber":1,"result":{"classType":"searchResults","results":[{"ui":"C1515945","rootSource":"MTH","uri":"https://uts-ws.nlm.nih.gov/rest/content/2016AA/CUI/C1515945","name":"American Indian or Alaska Native"}]}}
};

// FAKE UMLS requests
app.get('/rest/search/current', function(req, res) {
    var str = req.query.string.toLowerCase();
    if (req.query.inputType === "sourceUi") {
        res.send(JSON.stringify(umlsFromSrc[str]));
    } else {
        res.send(JSON.stringify(umlsSearches[str]));
    }
});

app.get('/rest/content/current/CUI/:cui/atoms', function(req, res) {
    var cui = req.params.cui;
    var src = req.query.sabs;
    res.send(JSON.stringify(umlsAtoms[cui][src]));
});

var meshRecordSearch = {
    'Disease': {"took":2,"timed_out":false,"_shards":{"total":5,"successful":5,"failed":0},"hits":{"total":1,"max_score":8.914252,"hits":[{"_index":"mesh_descriptor_44","_type":"descriptor","_id":"D004194","_score":8.914252,"_source":{"DescriptorClass":"1","DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}},"DateCreated":{"Year":{"t":"1999"},"Month":{"t":"01"},"Day":{"t":"01"}},"DateRevised":{"Year":{"t":"2013"},"Month":{"t":"07"},"Day":{"t":"09"}},"AllowableQualifiersList":{"AllowableQualifier":[{"QualifierReferredTo":{"QualifierUI":{"t":"Q000145"},"QualifierName":{"String":{"t":"classification"}}},"Abbreviation":{"t":"CL"}},{"QualifierReferredTo":{"QualifierUI":{"t":"Q000191"},"QualifierName":{"String":{"t":"economics"}}},"Abbreviation":{"t":"EC"}},{"QualifierReferredTo":{"QualifierUI":{"t":"Q000208"},"QualifierName":{"String":{"t":"ethnology"}}},"Abbreviation":{"t":"EH"}},{"QualifierReferredTo":{"QualifierUI":{"t":"Q000209"},"QualifierName":{"String":{"t":"etiology"}}},"Abbreviation":{"t":"ET"}},{"QualifierReferredTo":{"QualifierUI":{"t":"Q000235"},"QualifierName":{"String":{"t":"genetics"}}},"Abbreviation":{"t":"GE"}},{"QualifierReferredTo":{"QualifierUI":{"t":"Q000266"},"QualifierName":{"String":{"t":"history"}}},"Abbreviation":{"t":"HI"}},{"QualifierReferredTo":{"QualifierUI":{"t":"Q000523"},"QualifierName":{"String":{"t":"psychology"}}},"Abbreviation":{"t":"PX"}}]},"Annotation":{"t":"general only as a physiological, pathological, philosophical concept, opposite \"health\"; Manual 23.5+; / econ permitted but consider also economic aspects of disease as ECONOMICS, MEDICAL; / psychol permitted but consider also psychogenic origin of disease as PSYCHOPHYSIOLOGIC DISORDERS"},"EntryCombinationList":{"EntryCombination":[{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000175"},"QualifierName":{"String":{"t":"diagnosis"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D003933"},"DescriptorName":{"String":{"t":"Diagnosis"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000178"},"QualifierName":{"String":{"t":"diet therapy"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004035"},"DescriptorName":{"String":{"t":"Diet Therapy"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000188"},"QualifierName":{"String":{"t":"drug therapy"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004358"},"DescriptorName":{"String":{"t":"Drug Therapy"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000276"},"QualifierName":{"String":{"t":"immunology"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D007109"},"DescriptorName":{"String":{"t":"Immunity"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000401"},"QualifierName":{"String":{"t":"mortality"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D009026"},"DescriptorName":{"String":{"t":"Mortality"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000451"},"QualifierName":{"String":{"t":"nursing"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D009732"},"DescriptorName":{"String":{"t":"Nursing Care"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000453"},"QualifierName":{"String":{"t":"epidemiology"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004813"},"DescriptorName":{"String":{"t":"Epidemiology"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000473"},"QualifierName":{"String":{"t":"pathology"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D010336"},"DescriptorName":{"String":{"t":"Pathology"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000517"},"QualifierName":{"String":{"t":"prevention & control"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D011315"},"DescriptorName":{"String":{"t":"Preventive Medicine"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000532"},"QualifierName":{"String":{"t":"radiotherapy"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D011878"},"DescriptorName":{"String":{"t":"Radiotherapy"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000534"},"QualifierName":{"String":{"t":"rehabilitation"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D012046"},"DescriptorName":{"String":{"t":"Rehabilitation"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000628"},"QualifierName":{"String":{"t":"therapy"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D013812"},"DescriptorName":{"String":{"t":"Therapeutics"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000635"},"QualifierName":{"String":{"t":"transmission"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D018562"},"DescriptorName":{"String":{"t":"Disease Transmission, Infectious"}}}}},{"ECIN":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D004194"},"DescriptorName":{"String":{"t":"Disease"}}},"QualifierReferredTo":{"QualifierUI":{"t":"Q000662"},"QualifierName":{"String":{"t":"veterinary"}}}},"ECOUT":{"DescriptorReferredTo":{"DescriptorUI":{"t":"D000820"},"DescriptorName":{"String":{"t":"Animal Diseases"}}}}}]},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.288"}]},"ConceptList":{"Concept":[{"PreferredConceptYN":"Y","ConceptUI":{"t":"M0006564"},"ConceptName":{"String":{"t":"Disease"}},"ScopeNote":{"t":"A definite pathologic process with a characteristic set of signs and symptoms. It may affect the whole body or any of its parts, and its etiology, pathology, and prognosis may be known or unknown."},"TermList":{"Term":[{"ConceptPreferredTermYN":"Y","IsPermutedTermYN":"N","LexicalTag":"NON","RecordPreferredTermYN":"Y","TermUI":{"t":"T012740"},"String":{"t":"Disease"},"DateCreated":{"Year":{"t":"1999"},"Month":{"t":"01"},"Day":{"t":"01"}},"EntryVersion":{"t":"DIS"},"ThesaurusIDlist":{"ThesaurusID":[{"t":"BIOETHICS (1999)"},{"t":"POPLINE (1978)"}]},"_lowerCaseString":{"t":"disease"}},{"ConceptPreferredTermYN":"N","IsPermutedTermYN":"Y","LexicalTag":"NON","RecordPreferredTermYN":"N","TermUI":{"t":"T012740"},"String":{"t":"Diseases"},"_lowerCaseString":{"t":"diseases"}}]}}]},"_generated":{"RecordName":"Disease","RecordUI":"D004194","lowerCaseRecordName":"disease","notAnalyzedAnnotation":"general only as a physiological, pathological, philosophical concept, opposite \"health\"; Manual 23.5+; / econ permitted but consider also economic aspects of disease as ECONOMICS, MEDICAL; / psychol permitted but consider also psychogenic origin of disease as PSYCHOPHYSIOLOGIC DISORDERS","PreferredConceptScopeNote":"A definite pathologic process with a characteristic set of signs and symptoms. It may affect the whole body or any of its parts, and its etiology, pathology, and prognosis may be known or unknown.","notAnalyzedPreferredConceptScopeNote":"A definite pathologic process with a characteristic set of signs and symptoms. It may affect the whole body or any of its parts, and its etiology, pathology, and prognosis may be known or unknown.","EntryTerms":["Disease"],"lowerCaseEntryTerms":["disease"]}},"highlight":{"_generated.lowerCaseEntryTerms":["<strong>disease</strong>"]}}]}}
};
var meshUiRecords = {
    'D004194': {"_id":"57b5b7e51b1332852dccffec","DescriptorClass":"1","DateCreated":{"Year":{"t":"1999"},"Month":{"t":"01"},"Day":{"t":"01"}},"DateRevised":{"Year":{"t":"2013"},"Month":{"t":"07"},"Day":{"t":"09"}},"AllowableQualifiersList":{"AllowableQualifier":[{"Abbreviation":{"t":"CL"},"QualifierReferredTo":{"QualifierName":{"String":{"t":"classification"}},"QualifierUI":{"t":"Q000145"}}},{"Abbreviation":{"t":"EC"},"QualifierReferredTo":{"QualifierName":{"String":{"t":"economics"}},"QualifierUI":{"t":"Q000191"}}},{"Abbreviation":{"t":"EH"},"QualifierReferredTo":{"QualifierName":{"String":{"t":"ethnology"}},"QualifierUI":{"t":"Q000208"}}},{"Abbreviation":{"t":"ET"},"QualifierReferredTo":{"QualifierName":{"String":{"t":"etiology"}},"QualifierUI":{"t":"Q000209"}}},{"Abbreviation":{"t":"GE"},"QualifierReferredTo":{"QualifierName":{"String":{"t":"genetics"}},"QualifierUI":{"t":"Q000235"}}},{"Abbreviation":{"t":"HI"},"QualifierReferredTo":{"QualifierName":{"String":{"t":"history"}},"QualifierUI":{"t":"Q000266"}}},{"Abbreviation":{"t":"PX"},"QualifierReferredTo":{"QualifierName":{"String":{"t":"psychology"}},"QualifierUI":{"t":"Q000523"}}}]},"EntryCombinationList":{"EntryCombination":[{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Diagnosis"}},"DescriptorUI":{"t":"D003933"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"diagnosis"}},"QualifierUI":{"t":"Q000175"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Diet Therapy"}},"DescriptorUI":{"t":"D004035"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"diet therapy"}},"QualifierUI":{"t":"Q000178"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Drug Therapy"}},"DescriptorUI":{"t":"D004358"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"drug therapy"}},"QualifierUI":{"t":"Q000188"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Immunity"}},"DescriptorUI":{"t":"D007109"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"immunology"}},"QualifierUI":{"t":"Q000276"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Mortality"}},"DescriptorUI":{"t":"D009026"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"mortality"}},"QualifierUI":{"t":"Q000401"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Nursing Care"}},"DescriptorUI":{"t":"D009732"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"nursing"}},"QualifierUI":{"t":"Q000451"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Epidemiology"}},"DescriptorUI":{"t":"D004813"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"epidemiology"}},"QualifierUI":{"t":"Q000453"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Pathology"}},"DescriptorUI":{"t":"D010336"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"pathology"}},"QualifierUI":{"t":"Q000473"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Preventive Medicine"}},"DescriptorUI":{"t":"D011315"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"prevention & control"}},"QualifierUI":{"t":"Q000517"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Radiotherapy"}},"DescriptorUI":{"t":"D011878"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"radiotherapy"}},"QualifierUI":{"t":"Q000532"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Rehabilitation"}},"DescriptorUI":{"t":"D012046"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"rehabilitation"}},"QualifierUI":{"t":"Q000534"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Therapeutics"}},"DescriptorUI":{"t":"D013812"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"therapy"}},"QualifierUI":{"t":"Q000628"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease Transmission, Infectious"}},"DescriptorUI":{"t":"D018562"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"transmission"}},"QualifierUI":{"t":"Q000635"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}},{"ECOUT":{"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Animal Diseases"}},"DescriptorUI":{"t":"D000820"}}},"ECIN":{"QualifierReferredTo":{"QualifierName":{"String":{"t":"veterinary"}},"QualifierUI":{"t":"Q000662"}},"DescriptorReferredTo":{"DescriptorName":{"String":{"t":"Disease"}},"DescriptorUI":{"t":"D004194"}}}}]},"ConceptList":{"Concept":[{"TermList":{"Term":[{"_lowerCaseString":{"t":"disease"},"ThesaurusIDlist":{"ThesaurusID":[{"t":"BIOETHICS (1999)"},{"t":"POPLINE (1978)"}]},"EntryVersion":{"t":"DIS"},"DateCreated":{"Day":{"t":"01"},"Month":{"t":"01"},"Year":{"t":"1999"}},"String":{"t":"Disease"},"TermUI":{"t":"T012740"},"RecordPreferredTermYN":"Y","LexicalTag":"NON","IsPermutedTermYN":"N","ConceptPreferredTermYN":"Y"},{"_lowerCaseString":{"t":"diseases"},"String":{"t":"Diseases"},"TermUI":{"t":"T012740"},"RecordPreferredTermYN":"N","LexicalTag":"NON","IsPermutedTermYN":"Y","ConceptPreferredTermYN":"N"}]},"ScopeNote":{"t":"A definite pathologic process with a characteristic set of signs and symptoms. It may affect the whole body or any of its parts, and its etiology, pathology, and prognosis may be known or unknown."},"ConceptName":{"String":{"t":"Disease"}},"ConceptUI":{"t":"M0006564"},"PreferredConceptYN":"Y"}]},"_generated":{"RecordName":"Disease","RecordUI":"D004194","lowerCaseRecordName":"disease","notAnalyzedAnnotation":"general only as a physiological, pathological, philosophical concept, opposite \"health\"; Manual 23.5+; / econ permitted but consider also economic aspects of disease as ECONOMICS, MEDICAL; / psychol permitted but consider also psychogenic origin of disease as PSYCHOPHYSIOLOGIC DISORDERS","PreferredConceptScopeNote":"A definite pathologic process with a characteristic set of signs and symptoms. It may affect the whole body or any of its parts, and its etiology, pathology, and prognosis may be known or unknown.","notAnalyzedPreferredConceptScopeNote":"A definite pathologic process with a characteristic set of signs and symptoms. It may affect the whole body or any of its parts, and its etiology, pathology, and prognosis may be known or unknown.","relatedRegistryNumberList":[],"registryNumber":[],"lowerCaseEntryTerms":["disease"],"EntryTerms":["Disease"]},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.288"}]},"DescriptorName":{"String":{"t":"Disease"}},"Annotation":{"t":"general only as a physiological, pathological, philosophical concept, opposite \"health\"; Manual 23.5+; / econ permitted but consider also economic aspects of disease as ECONOMICS, MEDICAL; / psychol permitted but consider also psychogenic origin of disease as PSYCHOPHYSIOLOGIC DISORDERS"},"DescriptorUI":{"t":"D004194"}}
};
var meshTrees = {
  "C23.550.288":
  {"children":[{"_id":"57b5b8421b1332852dcd2303","_generated":{"RecordName":"Syndrome","RecordUI":"D013577"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.288.500"}]}}],"siblings":[{"_id":"57b5b8d31b1332852dcd5a06","_generated":{"RecordName":"Atrial Remodeling","RecordUI":"D064752"},"TreeNumberList":{"TreeNumber":[{"t":"C23.300.052"},{"t":"C23.550.113"},{"t":"G09.330.190.075.800"}]}},{"_id":"57b5b8d31b1332852dcd5b53","_generated":{"RecordName":"Vascular Remodeling","RecordUI":"D066253"},"TreeNumberList":{"TreeNumber":[{"t":"C23.300.977"},{"t":"C23.550.918"},{"t":"G09.330.930"}]}},{"_id":"57b5b7b91b1332852dcceec7","_generated":{"RecordName":"Acantholysis","RecordUI":"D000051"},"TreeNumberList":{"TreeNumber":[{"t":"C17.800.865.070"},{"t":"C23.550.035"}]}},{"_id":"57b5b7c31b1332852dccf47e","_generated":{"RecordName":"Arrhythmias, Cardiac","RecordUI":"D001145"},"TreeNumberList":{"TreeNumber":[{"t":"C14.280.067"},{"t":"C23.550.073"}]}},{"_id":"57b5b7c31b1332852dccf4b6","_generated":{"RecordName":"Ascites","RecordUI":"D001201"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.081"}]}},{"_id":"57b5b8b71b1332852dcd4d37","_generated":{"RecordName":"Azotemia","RecordUI":"D053099"},"TreeNumberList":{"TreeNumber":[{"t":"C12.777.419.936.231"},{"t":"C13.351.968.419.936.231"},{"t":"C23.550.145"}]}},{"_id":"57b5b8d31b1332852dcd5b24","_generated":{"RecordName":"Cardiotoxicity","RecordUI":"D066126"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.161"},{"t":"C25.100.389"},{"t":"C26.733.266"},{"t":"G01.750.748.500.266"}]}},{"_id":"57b5b8b71b1332852dcd4dac","_generated":{"RecordName":"Channelopathies","RecordUI":"D053447"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.177"}]}},{"_id":"57b5b7db1b1332852dccfaf8","_generated":{"RecordName":"Chromosome Aberrations","RecordUI":"D002869"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.210"},{"t":"G05.365.590.175"}]}},{"_id":"57b5b7db1b1332852dccfdd9","_generated":{"RecordName":"Death","RecordUI":"D003643"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.260"}]}},{"_id":"57b5b7db1b1332852dccfdff","_generated":{"RecordName":"Dehydration","RecordUI":"D003681"},"TreeNumberList":{"TreeNumber":[{"t":"C18.452.950.179"},{"t":"C23.550.274"}]}},{"_id":"57b5b8ad1b1332852dcd4c31","_generated":{"RecordName":"Delayed Graft Function","RecordUI":"D051799"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.277"}]}},{"_id":"57b5b7e51b1332852dccffec","_generated":{"RecordName":"Disease","RecordUI":"D004194"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.288"}]}},{"_id":"57b5b8861b1332852dcd3bd0","_generated":{"RecordName":"Disease Attributes","RecordUI":"D020969"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.291"}]}},{"_id":"57b5b8d31b1332852dcd5a1b","_generated":{"RecordName":"Dysbiosis","RecordUI":"D064806"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.308"}]}},{"_id":"57b5b7e51b1332852dcd01a0","_generated":{"RecordName":"Emphysema","RecordUI":"D004646"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.325"}]}},{"_id":"57b5b7f01b1332852dcd0362","_generated":{"RecordName":"Extravasation of Diagnostic and Therapeutic Materials","RecordUI":"D005119"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.340"},{"t":"C26.371"}]}},{"_id":"57b5b8ca1b1332852dcd5453","_generated":{"RecordName":"Femoracetabular Impingement","RecordUI":"D057925"},"TreeNumberList":{"TreeNumber":[{"t":"C05.550.384"},{"t":"C23.550.347"}]}},{"_id":"57b5b7f01b1332852dcd0441","_generated":{"RecordName":"Fibrosis","RecordUI":"D005355"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.355"}]}},{"_id":"57b5b8a21b1332852dcd452f","_generated":{"RecordName":"Genomic Instability","RecordUI":"D042822"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.362"},{"t":"G05.365.590.335"},{"t":"G05.370"}]}},{"_id":"57b5b7fa1b1332852dcd065b","_generated":{"RecordName":"Gliosis","RecordUI":"D005911"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.369"}]}},{"_id":"57b5b7fa1b1332852dcd0710","_generated":{"RecordName":"Granuloma","RecordUI":"D006099"},"TreeNumberList":{"TreeNumber":[{"t":"C15.604.515.292"},{"t":"C23.550.382"}]}},{"_id":"57b5b8ad1b1332852dcd4b4f","_generated":{"RecordName":"Granulomatosis, Orofacial","RecordUI":"D051261"},"TreeNumberList":{"TreeNumber":[{"t":"C07.465.353"},{"t":"C23.550.384"}]}},{"_id":"57b5b7fa1b1332852dcd072c","_generated":{"RecordName":"Growth Disorders","RecordUI":"D006130"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.393"}]}},{"_id":"57b5b7fa1b1332852dcd0869","_generated":{"RecordName":"Hemolysis","RecordUI":"D006461"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.403"},{"t":"G12.425.143.545"}]}},{"_id":"57b5b7fa1b1332852dcd0872","_generated":{"RecordName":"Hemorrhage","RecordUI":"D006470"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.414"}]}},{"_id":"57b5b8861b1332852dcd3c24","_generated":{"RecordName":"Hyperammonemia","RecordUI":"D022124"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.421"}]}},{"_id":"57b5b8991b1332852dcd4289","_generated":{"RecordName":"Hyperamylasemia","RecordUI":"D034321"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.425"}]}},{"_id":"57b5b8061b1332852dcd0a1d","_generated":{"RecordName":"Hyperbilirubinemia","RecordUI":"D006932"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.429"}]}},{"_id":"57b5b8061b1332852dcd0a3e","_generated":{"RecordName":"Hyperplasia","RecordUI":"D006965"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.444"}]}},{"_id":"57b5b8991b1332852dcd4245","_generated":{"RecordName":"Hyperuricemia","RecordUI":"D033461"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.449"}]}},{"_id":"57b5b8861b1332852dcd3b8e","_generated":{"RecordName":"Hypovolemia","RecordUI":"D020896"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.455"}]}},{"_id":"57b5b8061b1332852dcd0b53","_generated":{"RecordName":"Inflammation","RecordUI":"D007249"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.470"}]}},{"_id":"57b5b8061b1332852dcd0bff","_generated":{"RecordName":"Intraoperative Complications","RecordUI":"D007431"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.505"}]}},{"_id":"57b5b8061b1332852dcd0c4d","_generated":{"RecordName":"Ischemia","RecordUI":"D007511"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.513"}]}},{"_id":"57b5b8ad1b1332852dcd48f0","_generated":{"RecordName":"Leukoaraiosis","RecordUI":"D049292"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.522"}]}},{"_id":"57b5b8111b1332852dcd0df5","_generated":{"RecordName":"Leukocytosis","RecordUI":"D007964"},"TreeNumberList":{"TreeNumber":[{"t":"C15.378.553.475"},{"t":"C23.550.526"}]}},{"_id":"57b5b8861b1332852dcd39ad","_generated":{"RecordName":"Lithiasis","RecordUI":"D020347"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.537"}]}},{"_id":"57b5b7b91b1332852dccf03a","_generated":{"RecordName":"Long Term Adverse Effects","RecordUI":"D000069451"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.543"}]}},{"_id":"57b5b8111b1332852dcd0f2d","_generated":{"RecordName":"Malacoplakia","RecordUI":"D008287"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.548"}]}},{"_id":"57b5b8111b1332852dcd105c","_generated":{"RecordName":"Menstruation Disturbances","RecordUI":"D008599"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.568"}]}},{"_id":"57b5b8111b1332852dcd10a9","_generated":{"RecordName":"Metaplasia","RecordUI":"D008679"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.589"}]}},{"_id":"57b5b87b1b1332852dcd34f3","_generated":{"RecordName":"Muscle Weakness","RecordUI":"D018908"},"TreeNumberList":{"TreeNumber":[{"t":"C05.651.515"},{"t":"C10.597.613.593"},{"t":"C23.550.695"},{"t":"C23.888.592.608.593"}]}},{"_id":"57b5b81b1b1332852dcd131a","_generated":{"RecordName":"Necrosis","RecordUI":"D009336"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.717"},{"t":"G04.299.139.638"}]}},{"_id":"57b5b8ca1b1332852dcd54d0","_generated":{"RecordName":"Neointima","RecordUI":"D058426"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.722"}]}},{"_id":"57b5b81b1b1332852dcd1348","_generated":{"RecordName":"Neoplastic Processes","RecordUI":"D009385"},"TreeNumberList":{"TreeNumber":[{"t":"C04.697"},{"t":"C23.550.727"}]}},{"_id":"57b5b81b1b1332852dcd1360","_generated":{"RecordName":"Nerve Degeneration","RecordUI":"D009410"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.737"}]}},{"_id":"57b5b81b1b1332852dcd14d7","_generated":{"RecordName":"Ochronosis","RecordUI":"D009794"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.744"}]}},{"_id":"57b5b81b1b1332852dcd1598","_generated":{"RecordName":"Ossification, Heterotopic","RecordUI":"D009999"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.751"}]}},{"_id":"57b5b8ca1b1332852dcd568b","_generated":{"RecordName":"Polydipsia","RecordUI":"D059606"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.759"},{"t":"C23.888.663"}]}},{"_id":"57b5b82f1b1332852dcd1a0f","_generated":{"RecordName":"Postoperative Complications","RecordUI":"D011183"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.767"}]}},{"_id":"57b5b8d31b1332852dcd5b5d","_generated":{"RecordName":"Protein Aggregation, Pathological","RecordUI":"D066263"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.770"},{"t":"G02.111.668"}]}},{"_id":"57b5b8b71b1332852dcd4d3a","_generated":{"RecordName":"Respiratory Aspiration","RecordUI":"D053120"},"TreeNumberList":{"TreeNumber":[{"t":"C08.618.749"},{"t":"C23.550.773"}]}},{"_id":"57b5b8381b1332852dcd1dce","_generated":{"RecordName":"Retropneumoperitoneum","RecordUI":"D012188"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.794"},{"t":"C26.748"}]}},{"_id":"57b5b8381b1332852dcd1f57","_generated":{"RecordName":"Sclerosis","RecordUI":"D012598"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.823"}]}},{"_id":"57b5b8381b1332852dcd1ff9","_generated":{"RecordName":"Shock","RecordUI":"D012769"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.835"}]}},{"_id":"57b5b8d31b1332852dcd5a10","_generated":{"RecordName":"Teratogenesis","RecordUI":"D064793"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.863"}]}},{"_id":"57b5b84d1b1332852dcd2657","_generated":{"RecordName":"Ulcer","RecordUI":"D014456"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.891"}]}},{"_id":"57b5b8651b1332852dcd2da3","_generated":{"RecordName":"Yang Deficiency","RecordUI":"D016711"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.945"}]}},{"_id":"57b5b8651b1332852dcd2da2","_generated":{"RecordName":"Yin Deficiency","RecordUI":"D016710"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550.972"}]}}],"parents":[{"_id":"57b5b8421b1332852dcd22fb","_generated":{"RecordName":"Pathological Conditions, Signs and Symptoms","RecordUI":"D013568"},"TreeNumberList":{"TreeNumber":[{"t":"C23"}]}},{"_id":"57b5b8241b1332852dcd16dd","_generated":{"RecordName":"Pathologic Processes","RecordUI":"D010335"},"TreeNumberList":{"TreeNumber":[{"t":"C23.550"}]}}]}
};

app.get("/api/fieldSearch/record", function (req, res) {
    res.send(meshRecordSearch[req.query.q]);
});

app.get("/api/record/ui/:desc", function (req, res) {
    res.send(meshUiRecords[req.params.desc]);
});

app.get("/api/tree/:tn", function (req, res) {
    console.log(req)
    console.log(req.params.tn);
    res.send(meshTrees[req.params.tn]);
});

// Mocks UTS ticket validation process
app.post('/cas/serviceValidate', function(req, res) {
    if( req.query.ticket === 'invalid' ) {
        res.send("<cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'> <cas:authenticationFailure code='INVALID_TICKET'>ticket &#039;ST-430048-3Em71CBricwWoL7bd5nc-cas&#039; not recognized </cas:authenticationFailure></cas:serviceResponse>");
    } else if( req.query.ticket === 'valid' ) {
        res.send("<cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'> <cas:authenticationSuccess> <cas:user>ninds</cas:user> </cas:authenticationSuccess> </cas:serviceResponse>");
    } else if( req.query.ticket === 'timeout1' ) {
        // Return after 1 sec, ticket validation times out after 2 sec, ticket validation passes
        setTimeout(function() {
            res.send("<cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'> <cas:authenticationSuccess> <cas:user>ninds</cas:user> </cas:authenticationSuccess> </cas:serviceResponse>");
        }, 1000);
    } else if( req.query.ticket === 'timeout4' ) {
        // Return after 4 sec, ticket validation times out after 2 sec, ticket validation doesn't pass
        setTimeout(function() {
            res.send("<cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'> <cas:authenticationSuccess> <cas:user>ninds</cas:user> </cas:authenticationSuccess> </cas:serviceResponse>");
        }, 4000);
    }
});

var options = {
  key: fs.readFileSync(path.join(__dirname, './server.key')),
  cert: fs.readFileSync(path.join(__dirname, './server.crt'))
};

https.createServer(options, app).listen(app.get('port'), function(){
  console.log('VSAC Mock listening on port: ' + app.get('port'));
});

var net = require('net');
var server = net.createServer(function(c) { 
    var malicious = false;
    console.log('Scan connection started');
    var file = new Buffer(1024*1024*5);
    c.on('data', function(data) {
        file += data;

        var array = JSON.parse(JSON.stringify(data));
        try {
            var last4;
            if (array.data) last4 = array.data.slice(-4);
            else last4 = array.slice(-4);
            if (last4.length < 4) return;
            for (var i = 0; i < 3; i++) if (last4[i] !== 0) return;

            if (file.toString().indexOf("VIRUS") > -1) {
                malicious = true;
                console.log("setting malicious = true");
            }

            if (malicious) console.log("stream: A FOUND\n");
            else console.log("stream: OK\n");

            if (malicious) c.write("stream: A FOUND\n");
            else c.write("stream: OK\n");
        } catch (e) {
            if (malicious) console.log("stream: A FOUND\n");
            else console.log("stream: OK\n");

            if (malicious) c.write("stream: A FOUND\n");
            else c.write("stream: OK\n");
        }
    });
    c.on("end", function() {
        console.log("Scan connection closed");
    });
    c.on("error", function(err) {
        console.log(err);
    });    
});
server.listen(config.antivirus.port, function() { 
    console.log('ClamAV Fake daemon open on port: ' + config.antivirus.port);
});