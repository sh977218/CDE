<h4>Permissible Values</h4>

<dl class="dl-horizontal">
    <dt>Datatype:</dt>
    <dd>
        <div inline-edit id="listDatatype" model="elt.valueDomain.datatypeValueList.datatype" is-allowed="canCurate"
             on-ok="stageElt(elt)"></div>
    </dd>
</dl>
<hr/>

<div>
    <button ng-show="showValidateButton" ng-click="runManualValidation()">Validate</button>
</div>

<div ng-show="elt.valueDomain.permissibleValues.length === 0">No Permissible Values</div>

<div class="row">
    <div class="col-md-12">
        <div ng-if="containsKnownSystem">The list below includes codes with synonyms, you can also view them as:<br>
            <span ng-repeat="(key, value) in srcOptions" style="margin-left: 50px">
                <input ng-model="value.selected" type="checkbox" ng-disabled="value.disabled"
                       id="display{{key}}Codes">{{value.displayAs}} Codes
                <span ng-if="value.disabled"> (Login to enable)</span>
            </span>
        </div>
        <table ng-show="elt.valueDomain.permissibleValues.length > 0"
               class="table-bordered table-condensed table-striped"
               summary="List of permissible values">
            <thead>
            <tr>
                <th id="value">Value</th>
                <th id="codeName">Code Name</th>
                <th id="code">Code</th>
                <th id="codeSystem">Code System</th>
                <th id="UMLSCode" ng-if="srcOptions.UMLS.selected" colspan="2"
                    class="codeHeader extraCodeSystem">UMLS
                </th>
                <th id="NCICode" ng-if="srcOptions.NCI.selected" colspan="2"
                    class="codeHeader extraCodeSystem">NCI Thesaurus
                </th>
                <th id="LNCCode" ng-if="srcOptions.LNC.selected" colspan="2"
                    class="codeHeader extraCodeSystem">LOINC
                </th>
                <th id="SCTCode" ng-if="srcOptions.SNOMEDCT_US.selected" colspan="2"
                    class="codeHeader extraCodeSystem">SNOMEDCT US
                </th>
                <th id="codeDescription">Code Description</th>
                <th id="validation" ng-show="vsacMappingExists() || compareView">Match</th>
                <th id="actions" ng-show="canCurate">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr id="pvtr-{{$index}}" ng-repeat="pv in elt.valueDomain.permissibleValues | limitTo:pvLimit"
                itemscope itemtype="http://schema.org/MedicalCode">
                <td headers="value" id="pv-{{$index}}" class="codeNameCell">
                    <div inline-edit model="pv.permissibleValue" is-allowed="canCurate"
                         on-ok="stageElt(elt);checkPvUnicity();"></div>
                </td>
                <td headers="codeName" class="codeNameCell" id="pvName-{{$index}}" itemprop="name">
                    {{pv.valueMeaningName}}
                </td>
                <td headers="code" id="pvCode-{{$index}}" itemprop="codeValue"
                    class="codeCell">
                    {{pv.valueMeaningCode}}
                </td>
                <td headers="codeSystem" id="pvCodeSystem-{{$index}}" class="codeSystemCell"
                    itemprop="codingSystem">
                    {{pv.codeSystemName}}
                </td>
                <td headers="UMLSCode" id="nameAsUMLS-{{$index}}" ng-if="srcOptions.UMLS.selected"
                    class="codeNameCell extraCodeSystem">
                    {{pv.UMLS.valueMeaningName}}
                </td>
                <td headers="UMLSCode" id="codeAsUMLS-{{$index}}" ng-if="srcOptions.UMLS.selected"
                    class="codeCell">
                    {{pv.UMLS.valueMeaningCode}}
                </td>
                <td headers="NCICode" id="nameAsNCI-{{$index}}" ng-if="srcOptions.NCI.selected"
                    class="codeNameCell extraCodeSystem">
                    {{pv.NCI.valueMeaningName}}
                </td>
                <td headers="NCICode" id="codeAsNCI-{{$index}}" ng-if="srcOptions.NCI.selected"
                    class="codeCell">
                    {{pv.NCI.valueMeaningCode}}
                </td>
                <td headers="LNCCode" id="nameAsLNC-{{$index}}" ng-if="srcOptions.LNC.selected"
                    class="codeNameCell extraCodeSystem">
                    {{pv.LNC.valueMeaningName}}
                </td>
                <td headers="LNCCode" id="codeAsLNC-{{$index}}" ng-if="srcOptions.LNC.selected"
                    class="codeCell">
                    {{pv.LNC.valueMeaningCode}}
                </td>
                <td headers="SCTCode" id="nameAsSCT-{{$index}}" ng-if="srcOptions.SNOMEDCT_US.selected"
                    class="codeNameCell extraCodeSystem">
                    {{pv.SNOMEDCT_US.valueMeaningName}}
                </td>
                <td headers="SCTCode" id="codeAsSCT-{{$index}}" ng-if="srcOptions.SNOMEDCT_US.selected"
                    class="codeCell">
                    {{pv.SNOMEDCT_US.valueMeaningCode}}
                </td>
                <td headers="code" id="pvCodeDesc-{{$index}}" style="width: 20%" itemprop="description">
                    <div inline-area-edit model="pv.valueMeaningDefinition" is-allowed="canCurate"
                         on-ok="stageElt(elt); runDelayedManualValidation();"></div>
                </td>
                <td headers="validation" ng-show="vsacMappingExists() || compareView">
                     <span ng-switch="pv.isValid">
                         <i ng-switch-when="true" class="fa fa-check text-success" id="pv-{{$index}}-valid"></i>
                         <i ng-switch-default class="fa fa-exclamation text-warning" id="pv-{{$index}}-warning"></i>
                     </span>
                </td>
                <td headers="actions" ng-if="canCurate" style="width: 4%">
                    <span ng-if="pv.notValid">
                        <span class="btn-default fa fa-warning text-danger" id="pv-{{$index}}-notValid"> </span>
                    </span>
                    <span id="pvRemove-{{$index}}" class="btn-default fa fa-trash-o" ng-click="removePv($index)"
                          title="Remove" href=""></span>
                    <sortable-array the-array="elt.valueDomain.permissibleValues" index="$index"
                                    cb="stageElt(elt)"></sortable-array>
                </td>
            </tr>

            <tr ng-show="elt.valueDomain.permissibleValues.length > pvLimit">
                <td colspan="6">Showing {{pvLimit}} values.
                    <a class="btn btn-small btn-default fa fa-plus" ng-click="pvLimit = pvLimit + 50" id="showMorePvs">
                        Show
                        more</a>
                </td>
            </tr>

            </tbody>
        </table>
    </div>
</div>

<div class="mt20">
    <a class="btn btn-small btn-default" ng-show="canCurate" ng-click="addPv()" ng-disabled="!canAddPv()">
        <i id="addPv" class="fa fa-plus"></i> Add Permissible Value</a>
    <a class="btn btn-small btn-default" ng-show="canCurate" ng-click="removeAllPvs()">
        <i id="removeAllPvs" class="fa fa-trash-o"></i> Remove All Values</a>
</div>
<hr/>

<div ng-include="'/cde/public/html/valueDomainVsac.html'"></div>
