<div ng-controller="DerivationRulesCtrl">
    <h4>Derivation Rules</h4>

    <div tabindex="0" ng-if="elt.derivationRules[0] !== null">There are no derivation rules.</div>

    <div ng-repeat="derRule in elt.derivationRules">
        <div class="row">
            <div class="col-md-1 text-right" ng-show="canCurate">
                <a ng-click="removeDerivationRule($index)" ng-hide="showDelete" class="fa fa-trash-o"
                   id="removeDerivationRule-{{$index}}" title="Remove" href=""></a>
            </div>
            <div class="col-md-11">
                <dl class="dl-horizontal">
                    <dt tabindex="0">Name:</dt>
                    <dd tabindex="0" id="dd_derRule_name_{{$index}}">{{derRule.name}}</dd>
                    <dt tabindex="0">Rule Type:</dt>
                    <dd tabindex="0" id="dd_derRule_type_{{$index}}">{{derRule.ruleType}}</dd>
                    <dt tabindex="0">Input CDEs:</dt>
                    <dd tabindex="0" id="dd_derRule_input_{{$index}}">
                        <a ng-repeat="input in derRule.fullCdes | limitTo:8"
                           ng-href="/#/deview/?tinyId={{input.tinyId}}">
                            {{input.naming[0].designation}} {{!$last?'- ':''}}</a>
                        <span ng-if="derRule.fullCdes.length > 8"> and {{derRule.fullCdes.length - 8}} more</span>
                    </dd>
                </dl>
            </div>
        </div>
    </div>


    <button ng-if="canCurate" class="btn btn-small btn-default" value="add" ng-click="openDerivationRule()"
            id="addDerivationRule"><i class="fa fa-plus"> </i> Add Derivation Rule
    </button>

    <div ng-if="elt.derivationOutputs.length > 0">
        <hr/>
        <h5>This Data Element is used to derive to the following Data Elements:</h5>
        <table class="table cdeTable">
            <thead>
                <th class="col-xs-3">Rule Name</th>
                <th class="col-xs-9">CDE Name</th>
            </thead>
            <tbody>
                <tr ng-repeat="derOut in elt.derivationOutputs">
                    <td class="col-xs-3">{{derOut.ruleName}}</td>
                    <td class="col-xs-9">
                        <a ng-href="/#/deview/?tinyId={{derOut.cde.tinyId}}">{{derOut.cde.naming[0].designation}}</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script type="text/ng-template" id="newDerivationRuleModalContent.html">
    <div class="modal-header" id="newDerivationRuleModalHeader">
        <h4 tabindex="0">Add Derivation Rule</h4>
    </div>
    <form name="form" role="form">
        <div class="modal-body" id="newDerivationRuleModalBody">
            <div class="form-group">All Data Elements in your quickboard will be added to the derivation rule.</div>
            <div class="form-group">
                <label tabindex="0" for="newDerivationRule.name">Name: </label>
                <input tabindex="0" class="form-control" ng-model="newDerivationRule.name"
                       id="newDerivationRule.name" Placeholder="Rule Name" required />
            </div>
            <div class="form-group">
                <label tabindex="0" for="newDerivationRule.inputs">Inputs: </label>
                <span id="newDerivationRule.inputs">All CDEs in your quickboard.</span>
            </div>
            <div class="form-group">
                <label tabindex="0" for="newDerivationRule.ruleType">Rule Type: </label>
                <select tabindex="0" class="form-control" ng-model="newDerivationRule.ruleType"
                       id="newDerivationRule.ruleType" required>
                    <option value="score">Score</option>
                    <option value="panel">Panel / Measure</option>
                </select>
            </div>
            <div class="form-group">
                <label tabindex="0" for="newDerivationRule.formula">Formula: </label>
                <select tabindex="0" class="form-control" ng-model="newDerivationRule.formula"
                        id="newDerivationRule.formula" required>
                    <option value="sumAll">Sum of all</option>
                    <option value="">None</option>
                </select>
            </div>
        </div>
        <div class="modal-footer" id="newDerivationModalFooter">
            <button class="btn cancel" ng-click="cancelCreate()" id="cancelCreate" type="button">Cancel</button>
            <button class="btn btn-warning" ng-click="okCreate()" ng-disabled="isClean() || form.$invalid"
                    id="createDerivationRule" type="submit">Save
            </button>
        </div>
    </form>
</script>
