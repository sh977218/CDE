<div ng-controller="DerivationRulesCtrl">
    <h4>Derivation Rules</h4>

    <div tabindex="0" ng-if="elt.derivationRules < 1">There are no derivation rules.</div>

    <div ng-repeat="derRule in elt.derivationRules">
        <div class="row">
            <div class="col-md-1 text-right" ng-show="canCurate">
                <a ng-click="removeDerivationRule($index)" ng-hide="showDelete" class="fa fa-trash-o"
                   id="removeDerivationRule-{{$index}}" title="Remove" href=""></a>
            </div>
            <div class="col-md-11">
                <dl class="dl-horizontal">
                    <dt tabindex="0">Name:</dt>
                    <dd tabindex="0" id="dd_derRule_name_{{$index}}">{{derRule.name}}</dd>
                    <dt tabindex="0">Rule Type:</dt>
                    <dd tabindex="0" id="dd_derRule_type_{{$index}}">{{derRule.ruleType}}</dd>
                    <dt tabindex="0">Input CDEs:</dt>
                    <dd tabindex="0" id="dd_derRule_input_{{$index}}">
                        <a ng-repeat="input in derRule.fullCdes | limitTo:8"
                           ng-href="/deview/?tinyId={{input.tinyId}}">
                            {{input.naming[0].designation}} {{!$last?'- ':''}}</a>
                        <span ng-if="derRule.fullCdes.length > 8"> and {{derRule.fullCdes.length - 8}} more</span>
                    </dd>
                </dl>
            </div>
        </div>
    </div>


    <button ng-if="canAddScore()" class="btn btn-small btn-default" value="add" ng-click="openNewScore()"
            id="addNewScore"><i class="fa fa-plus"> </i> Add Score
    </button>

    <div ng-if="elt.derivationOutputs.length > 0">
        <hr/>
        <h5>This Data Element is used to derive to the following Data Elements:</h5>
        <table class="table cdeTable">
            <thead>
                <th class="col-xs-3">Rule Name</th>
                <th class="col-xs-9">CDE Name</th>
            </thead>
            <tbody>
                <tr ng-repeat="derOut in elt.derivationOutputs">
                    <td class="col-xs-3">{{derOut.ruleName}}</td>
                    <td class="col-xs-9">
                        <a ng-href="/deview/?tinyId={{derOut.cde.tinyId}}">{{derOut.cde.naming[0].designation}}</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<script type="text/ng-template" id="newScoreModalContent.html">
    <div class="modal-header" id="newScoreModalHeader">
        <h4 tabindex="0">Add Score</h4>
    </div>
    <form name="form" role="form">
        <div class="modal-body" id="newScoreModalBody">
            <div class="form-group">All Data Elements in your quickboard will be added to the score.</div>
            <div class="form-group">
                <label tabindex="0" for="newDerivationRule.name">Name: </label>
                <input tabindex="0" class="form-control" ng-model="newDerivationRule.name"
                       id="newDerivationRule.name" Placeholder="Score Name" required />
            </div>
            <div class="form-group">
                <label tabindex="0" for="newDerivationRule.inputs">Inputs: </label>
                <span ng-switch="invalidCdeMessage === undefined" id="newDerivationRule.inputs">
                    <span ng-switch-when="true">All {{modalQuickBoard.elts.length}} CDEs in your quickboard.</span>
                    <span ng-switch-default class="error-block">{{invalidCdeMessage}}</span>
                </span>
            </div>
            <div class="form-group">
                <label tabindex="0" for="newDerivationRule.ruleType">Rule Type: </label>
                <span id="newDerivationRule.ruleType">Score</span>
            </div>
            <div class="form-group">
                <label tabindex="0" for="newDerivationRule.formula">Formula: </label>
                <span id="newDerivationRule.formula">Sum of All</span>
            </div>
        </div>
        <div class="modal-footer" id="newDerivationModalFooter">
            <button class="btn cancel" ng-click="cancelCreate()" id="cancelCreate" type="button">Cancel</button>
            <button class="btn btn-warning" ng-click="okCreate()" ng-disabled="someCdesInvalid() || isClean() || form.$invalid"
                    id="createDerivationRule" type="submit">Save
            </button>
        </div>
    </form>
</script>
