<div *ngFor="let comment of comments; let i = index" class="mb-5" style=" width: 260px; ">
    <div class="commentDiv" [ngClass]="{currentTabComment:comment.currentComment}"
         style="background-color: white;box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);">
        <div *ngIf="comment.currentComment" id="currentComment_{{i}}" class="currentComment">
            <div class="outer-arrow"></div>
            <div class="inner-arrow"></div>
        </div>
        <div class="comment border">
            <div class="commentHeader p-2">
                <ng-container *ngIf="!comment.avatarUrl">
                    <img class="float-left" src="/cde/public/assets/img/min/portrait.png" width="32" height="32"
                         alt="portrait"/>
                </ng-container>
                <ng-container *ngIf="comment.avatarUrl">
                    <img class="float-left" [src]="comment.avatarUrl" width="32" height="32"
                         alt="portrait"/>
                </ng-container>
                <div class=" float-left mx-2" style="width:120px;">
                    <div style="font-size:13px;">{{comment.user.username}}</div>
                    <div style="font-size:11px;">{{comment.created | date: 'MM/dd/yyyy @ h:mma'}}</div>
                </div>
                <div class="float-left">
                    <mat-icon id="removeComment-{{i}}" title="RemoveComment" *ngIf="canRemoveComment(comment);"
                              (click)="removeComment(comment._id)">delete
                    </mat-icon>
                    <mat-icon id="resolveComment-{{i}}" title="ResolveComment" *ngIf="canResolveComment(comment);"
                              (click)="resolveComment(comment._id)">check_circle_outline
                    </mat-icon>
                    <mat-icon id="reopenComment-{{i}}" title="ReopenComment" *ngIf="canReopenComment(comment);"
                              (click)="reopenComment(comment._id)">undo
                    </mat-icon>
                </div>
                <div class="clearfix"></div>
                <div class="commentBody">
                    <div style="word-wrap: break-word;">
                        <s *ngIf="comment.status === 'resolved'">{{comment.text}}</s>
                        <ng-container *ngIf="comment.status !=='resolved'">{{comment.text}}</ng-container>
                    </div>
                </div>
            </div>
            <div *ngIf="comment.replies.length > 5" class="p-2 border"
                 style="background-color: rgb(245, 245, 245);">
                <span class="fake-link" *ngIf="!comment.showAllReplies" id="showAllRepliesButton_{{i}}"
                      (click)="comment.showAllReplies = true;">Show all {{comment.replies.length}} replies
                </span>
                <span class="fake-link" *ngIf="comment.showAllReplies" id="showLessRepliesButton_{{i}}"
                      (click)="comment.showAllReplies = false;">Show less replies
                </span>
            </div>
            <ng-container *ngFor="let reply of comment.replies; let j = index">
                <div *ngIf="!comment.showAllReplies && j > 2" class="replyDiv p-2 border"
                     style="background-color: rgb(245, 245, 245);">
                    <div class="replyHeader">
                        <img class="float-left" src="/cde/public/assets/img/min/portrait.png" width="32" height="32"
                             alt="portrait"/>
                        <div class=" float-left mx-2" style="width:120px;">
                            <div style="font-size:13px;">{{reply.user.username}}</div>
                            <div style="font-size:11px;">{{reply.created | date: 'MM/dd/yyyy @ h:mma'}}</div>
                        </div>
                        <div class="float-left">
                            <mat-icon id="removeReply-{{i}}_{{j}}" title="RemoveReply"
                                      *ngIf="canRemoveComment(reply);" (click)="removeReply(reply._id)">delete
                            </mat-icon>
                            <mat-icon id="resolveReply-{{i}}_{{j}}" title="ResolveReply"
                                      *ngIf="canResolveComment(reply);" (click)="resolveReply(reply._id)">
                                check_circle_outline
                            </mat-icon>
                            <mat-icon id="reopenReply-{{i}}_{{j}}" title="ReopenReply"
                                      *ngIf="canReopenComment(reply);" (click)="reopenReply(reply._id)">undo
                            </mat-icon>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="replyBody">
                        <s *ngIf="reply.status === 'resolved'">{{reply.text}}</s>
                        <ng-container *ngIf="reply.status !=='resolved'">{{reply.text}}</ng-container>
                    </div>
                </div>
            </ng-container>
            <div class="newReply p-2 border" style="background-color: rgb(245, 245, 245);">
                <div class="newReplyInfo" *ngIf="comment.currentlyReplying">Someone is typing</div>
                <form #newReplyForm="ngForm" name="newReplyForm_{{i}}" id="newReplyForm_{{i}}" novalidate
                      (ngSubmit)="replyToComment(comment);">
                    <input [(ngModel)]="comment.newReply.text" (ngModelChange)="changeOnReply(comment)"
                           class="form-control"
                           id="newReplyTextArea_{{i}}" name="newReplyTextArea" placeholder="Reply to this comment"
                           required/>
                    <ng-container *ngIf="comment.newReply.text">
                        <button class="btn btn-outline-dark" id="replyBtn_{{i}}" name="replyBtn_{{i}}"
                                type="submit" [disabled]="!newReplyForm.form.valid">Reply
                        </button>
                        <button class="btn btn-outline-dark" (click)="cancelReply(comment);">Cancel</button>
                    </ng-container>
                </form>
            </div>
        </div>
    </div>
</div>
