<h2>Display Profiles</h2>
<div *ngIf="dPVMs.length === 0">
    There are no Display Profiles.
</div>
<mat-card *ngFor="let dPVM of dPVMs; index as index" id="profile_{{index}}">
    <mat-card-header>
        <mat-card-title>
            <h3 class="d-inline">{{dPVM.profile.name}}</h3>
            <cde-delete-with-confirm class="d-inline" (click)="interruptEvent($event)"
                                     (deleted)="removeDisplayProfile(index)">
            </cde-delete-with-confirm>
        </mat-card-title>
    </mat-card-header>
    <mat-card-content>
        <div class="row">
            <div class="col-lg-5 col-sm-12">
                <mat-card>
                    <mat-card-header>
                        <mat-card-title>
                            <cde-inline-edit id="profileNameEdit_{{index}}" [(model)]="dPVM.profile.name"
                                             [isAllowed]="canEdit" (modelChange)="eltChange.emit();">
                            </cde-inline-edit>
                        </mat-card-title>
                    </mat-card-header>
                    <mat-card-content>
                        <section class="d-flex flex-column">
                            <mat-form-field>
                                <mat-select class="form-control" [disabled]="!canEdit" placeholder="Default View"
                                            [(value)]="dPVM.profile.displayType" (valueChange)="setDisplayType(dPVM)">
                                    <mat-option value="Follow-up">Print (Follow-up style)</mat-option>
                                    <mat-option value="Dynamic">Digital (Dynamic style)</mat-option>
                                </mat-select>
                            </mat-form-field>
                            <mat-checkbox id="displayAsMatrix_{{index}}" [disabled]="!canEdit"
                                          [(ngModel)]="dPVM.profile.sectionsAsMatrix"
                                          (change)="eltChange.emit()">Sections as matrices
                            </mat-checkbox>
                            <mat-checkbox id="displayValues_{{index}}" [disabled]="!canEdit"
                                          [(ngModel)]="dPVM.profile.displayValues"
                                          (change)="eltChange.emit()">Display answer values
                            </mat-checkbox>
                            <mat-checkbox id="displayInstructions_{{index}}" [disabled]="!canEdit"
                                          [(ngModel)]="dPVM.profile.displayInstructions"
                                          (change)="eltChange.emit()">Display Instructions
                            </mat-checkbox>
                            <mat-checkbox id="displayCopyright_{{index}}" [disabled]="!canEdit"
                                          [(ngModel)]="dPVM.profile.displayCopyright"
                                          (change)="eltChange.emit()">Display Copyright
                            </mat-checkbox>
                            <mat-checkbox id="displayNumbering_{{index}}" [disabled]="!canEdit"
                                          [(ngModel)]="dPVM.profile.displayNumbering"
                                          (change)="eltChange.emit()">Display Question Numbers
                            </mat-checkbox>
                            <mat-checkbox id="displayInvisible_{{index}}" [disabled]="!canEdit"
                                          [(ngModel)]="dPVM.profile.displayInvisible"
                                          (change)="eltChange.emit()">Display Invisible Questions
                            </mat-checkbox>
                            <div>
                                Number of Columns: <span id="nbOfColumnsValue">{{dPVM.profile.numberOfColumns}}</span>
                            </div>
                            <mat-slider min="1" max="6" step="1" thumbLabel="true" tickInterval="1"
                                        [ngModel]="dPVM.profile.numberOfColumns"
                                        (ngModelChange)="onChange(dPVM.profile,$event)"
                                        [disabled]="!canEdit"></mat-slider>
                            <mat-form-field>
                                <input matInput id="displayRepeatFormat_{{index}}" class="form-control"
                                       [disabled]="!canEdit"
                                       placeholder="Repeat Format String"
                                       [(ngModel)]="dPVM.profile.repeatFormat" (change)="eltChange.emit()">
                                <mat-hint>(Use # in place of number. Ex: "#." for "1.")</mat-hint>
                            </mat-form-field>
                            <mat-checkbox id="displayMetadataDevice_{{index}}" [disabled]="!canEdit"
                                          [(ngModel)]="dPVM.profile.metadata.device"
                                          (change)="eltChange.emit()">Display Metadata Device
                            </mat-checkbox>
                        </section>
                    </mat-card-content>
                </mat-card>
                <mat-card *ngIf="getMapToFhirResource(elt) === 'Procedure'">
                    <mat-card-header>Procedure Mapping</mat-card-header>
                    <mat-card-actions>
                        <button mat-raised-button (click)="openProcedureMapping(dPVM)">Procedure Mapping</button>
                    </mat-card-actions>
                </mat-card>
            </div>
            <div class="col-lg-7 col-sm-12">
                <mat-card>
                    <mat-card-header>
                        <mat-card-title>
                            Preview
                        </mat-card-title>
                    </mat-card-header>
                    <mat-card-content>
                        <cde-native-render class="nativeRenderPreview"
                                           [elt]="dPVM.sample" [profile]="dPVM.profile"
                                           [nativeRenderType]="dPVM.profile.displayType"></cde-native-render>
                    </mat-card-content>
                </mat-card>

                <mat-card>
                    <mat-card-header>
                        <mat-card-title>
                            Unit of Measure Aliases
                            <button mat-raised-button (click)="uomAliasEdit(dPVM)" *ngIf="canEdit">
                                <ng-container *ngIf="dPVM.aliases.edit; else uomEdit">
                                    Okay
                                    <mat-icon>done</mat-icon>
                                </ng-container>
                                <ng-template #uomEdit>
                                    Edit
                                    <mat-icon>edit</mat-icon>
                                </ng-template>
                            </button>
                        </mat-card-title>
                    </mat-card-header>
                    <mat-card-content>
                        <div class="row">
                            <ng-template #displayAliases>
                                <ng-container *ngFor="let u of dPVM.profile.unitsOfMeasureAlias">
                                    <span class="col-12 col-sm-6 col-lg-12 col-xl-6 mb-1">
                                        <ng-container *ngIf="u.unitOfMeasure.system">
                                            {{u.unitOfMeasure.system}}/</ng-container>
                                        {{u.unitOfMeasure.code}}: {{u.alias}}
                                    </span>
                                </ng-container>
                                <div *ngIf="!dPVM.profile.unitsOfMeasureAlias.length" class="w-100 text-center">
                                    No Aliases are Defined.
                                </div>
                            </ng-template>
                            <ng-container *ngIf="dPVM.aliases.edit; else displayAliases">
                                <ng-container *ngFor="let u of uoms">
                                    <span class="col-sm-6 col-lg-12 col-xl-6 mb-1"
                                          id="alias-{{u.u.system}}-{{u.u.code}}">
                                        <ng-container *ngIf="u.u.system">{{u.u.system}}/</ng-container>
                                        {{u.u.code}}:
                                        <select class="form-control" [disabled]="!canEdit"
                                                [ngModel]="profileAliasGet(dPVM, u.u)"
                                                (ngModelChange)="profileAliasSet(dPVM, u.u, $event)">
                                            <option *ngFor="let option of u.a">{{option}}</option>
                                        </select>
                                    </span>
                                </ng-container>
                                <div *ngIf="!uoms.length" class="w-100 text-center">
                                    This form contains no units of measure.
                                </div>
                            </ng-container>
                        </div>
                    </mat-card-content>
                </mat-card>

                <mat-card>
                    <mat-card-header>
                        <mat-card-title>View Specific Settings</mat-card-title>
                    </mat-card-header>
                    <mat-card-content>
                        <mat-tab-group class="demo-tab-group">
                            <mat-tab label="Digital View">
                                <mat-form-field>
                                    <input matInput id="displayAnswerDropdownLimit_{{index}}" class="form-control"
                                           type="number" min="0" [disabled]="!canEdit"
                                           placeholder="Multiple choice answer limit"
                                           [(ngModel)]="dPVM.profile.answerDropdownLimit" (change)="eltChange.emit()">
                                    <mat-hint>(Bottom limit for diplay as drop-down instead of multiple-choice.)
                                    </mat-hint>
                                </mat-form-field>
                            </mat-tab>
                            <mat-tab label="Print View" disabled>
                            </mat-tab>
                        </mat-tab-group>
                    </mat-card-content>
                </mat-card>
            </div>
        </div>
    </mat-card-content>
</mat-card>
<button *ngIf="canEdit" mat-raised-button class="mt-2" (click)="addProfile()" color="primary">
    <mat-icon style="font-weight: 900">add</mat-icon>
    Add Profile
</button>

