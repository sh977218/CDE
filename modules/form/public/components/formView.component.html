<div class="container-fluid" itemscope="http://schema.org/MedicalCode">
    <ng-container *ngIf="!eltLoaded">
        <h1 class="pt60 pb40 text-center">
            <i class="fa fa-spinner fa-pulse"></i>Loading...
        </h1>
    </ng-container>
    <ng-container *ngIf="eltLoaded">
        <div *ngIf="elt.archived" class="alert alert-warning mt20" role="alert">
            <i class="fa fa-exclamation-triangle"></i>
            <strong>Warning:</strong> this form is archived. You can
            <a href="/formView?tinyId={{elt.tinyId}}">view the current version here</a>.
        </div>
        <div *ngIf="elt.registrationState.registrationStatus=='Retired'" class="alert alert-warning mt20" role="alert">
            <i class="fa fa-exclamation-triangle"></i>
            <strong>Warning:</strong> this data element is retired.
            <span *ngIf="elt.registrationState.replacedBy">
                    <a href="/deView?tinyId={{elt.registrationState.replacedBy.tinyId}}">Replacement</a></span></div>
        <div *ngIf="elt.registrationState.administrativeStatus=='Retire Candidate'" class="alert alert-warning mt20"
             role="alert">
            <i class="fa fa-exclamation-triangle"></i>
            <strong>Warning:</strong> this data element is about to be retired.
            <span *ngIf="elt.registrationState.replacedBy">
                    <a href="/deView?tinyId={{elt.registrationState.replacedBy.tinyId}}">Possible Replacement</a>
            </span>
        </div>
        <div *ngIf="displayStatusWarning" class="alert alert-info mt20" role="alert">
            <i class="fa fa-exclamation-triangle"></i>
            <strong>Note:</strong> You may not edit this CDE because it is standard.
        </div>
        <div *ngIf="elt.forkOf" class="alert alert-info mt20" role="alert">
            <i class="fa fa-exclamation-triangle"></i>
            You are editing a fork. <a href="/deView?cdeId={{rootFork._id}}">
            <i class="fa fa-eye"></i> View Original</a>. To remove a fork, Retire it.
        </div>
        <div class="row">
            <div [ngClass]="{'col-sm-9 eltCommentView':commentMode,'col-sm-12':!commentMode}">
                <h1 class="page-header">{{elt.naming[0].designation}}
                    <button id="addToQuickBoard" class="btn btn-small btn-default" role="button"
                            title="Add to Compare List" type="button">
                        <i class="fa fa-plus"></i> Add to Quick Board
                    </button>
                    <button id="addToBoard" class="btn btn-small btn-default" role="button" title="Add to Board"
                            type="button">
                        <i class="fa fa-thumb-tack"></i> Add to Board
                    </button>
                    <div class="btn-group" role="group">
                        <button id="export" type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                            <i class="fa fa-download"></i> Export
                        </button>
                        <div class="dropdown-menu" aria-labelledby="export">
                            <ng-container *ngIf="user._id">
                                <a id='nihJson' [href]="form/{{elt._id}}" target="_blank">JSON File,
                                    NIH/CDE Schema</a>
                                <a *ngIf="user._id" id='odmExport' [href]="form/{{elt._id}}?type=xml&subtype=odm"
                                   target="_blank">XML File, ODM Schema</a>
                                <a *ngIf="user._id" id='sdcExport' [href]="form/{{elt._id}}?type=xml&subtype=sdc"
                                   target="_blank">XML File, SDC Schema</a>
                                <a *ngIf="user._id && !isIe()" id='sdcHtmlExport'
                                   [href]="form/{{elt._id}}?type=xml&subtype=sdc&renderer=defaultHtml" target="_blank">
                                    XML File, SDC Schema with XSL Transform</a>
                                <a *ngIf="user._id" id='nihXml' [href]="form/{{elt._id}}?type=xml" target="_blank">
                                    XML File, NIH/CDE Schema</a>
                                <a *ngIf="user._id" id='formPublishExport' (click)="preparePublishExport()"
                                   target="_blank">Published Form</a>
                                <a *ngIf="user._id" id='nihRedCap' [href]="form/{{elt._id}}?type=REDCap"
                                   target="_blank">REDCap</a>
                            </ng-container>
                            <a *ngIf="!user._id" href="login">Please login to export forms.</a></li>
                        </div>
                    </div>

                    <button id="copyCdeBtn" class="btn btn-small btn-default" role="button"
                            (click)="openCopyElementModal()" title="Copy CDE" type="button">
                        <i class="fa fa-clone"></i> Copy
                    </button>

                    <button id="discussBtn" class="btn btn-small btn-default" role="button" title="Discuss CDE"
                            type="button">
                        <i class="fa fa-comment"></i> Discuss
                    </button>
                </h1>
                <ngb-tabset>
                    <ngb-tab title="General Details">
                        <ng-template ngbTabContent>
                            <cde-form-general-details [elt]="elt"></cde-form-general-details>
                        </ng-template>
                        <ngb-tab title="Form Element">
                            <ng-template ngbTabContent>
                                <cde-form-description [cache]="cache" [elt]="elt" [in-score-cdes]="inScoreCdes"
                                                      (cachePut)="cachePut($event)" (is-form-valid)="setIsValid($event)"
                                                      (stage-elt)="stageElt()"></cde-form-description>
                            </ng-template>
                        </ngb-tab>
                        <ngb-tab title="Naming">
                            <ng-template ngbTabContent>
                                <cde-admin-item-naming [elt]="elt"></cde-admin-item-naming>
                            </ng-template>
                        </ngb-tab>
                        <ngb-tab title="Classification">
                            <ng-template ngbTabContent>
                                <cde-admin-item-classification [elt]="elt"></cde-admin-item-classification>
                            </ng-template>
                        </ngb-tab>
                        <ngb-tab title="Reference Documents">
                            <cde-admin-item-reference-document [elt]="elt"></cde-admin-item-reference-document>
                            <ng-template ngbTabContent>
                            </ng-template>
                        </ngb-tab>
                        <ngb-tab title="Properties">
                            <ng-template ngbTabContent>
                                <cde-admin-item-properties [elt]="elt"></cde-admin-item-properties>
                            </ng-template>
                        </ngb-tab>
                        <ngb-tab title="Identifiers">
                            <ng-template ngbTabContent>
                                <cde-admin-item-ids [elt]="elt"></cde-admin-item-ids>
                            </ng-template>
                        </ngb-tab>
                        <ngb-tab title="Attachments">
                            <ng-template ngbTabContent>
                                <cde-admin-item-attachments [elt]="elt"></cde-admin-item-attachments>
                            </ng-template>
                        </ngb-tab>
                        <ngb-tab title="History">
                            <ng-template ngbTabContent>
                                <cde-admin-item-history [elt]="elt"></cde-admin-item-history>
                            </ng-template>
                        </ngb-tab>
                </ngb-tabset>
            </div>
        </div>
        <div class="row" *ngIf="elt.unsaved">
            <cde-update-element [elt]="elt" (discard)="reload($event);"
                                (save)="saveDataElement($event)"></cde-update-element>
        </div>
    </ng-container>
</div>

<ng-template #copyDataElementContent id="copyDataElementModal" let-c="close" let-d="dismiss">
    <div class="modal-header" id="copyDataElementModalHeader">
        <h4 class="modal-title">Create a copy</h4>
    </div>
    <div class="modal-body" id="copyDataElementModalBody">
        <p class="text-info">You are about to create a new CDE/Form by duplicating this one. Please specify a new name
            and a classification of the CDE/Form.</p>
        <cde-create-data-element [elt]="eltCopy" (cancel)="closeCopyElementModal()"></cde-create-data-element>
    </div>
</ng-template>


<!--
<uib-tabset active="currentTab">
    <uib-tab id="general_tab" index="'general'">
        <uib-tab-heading
                ngClass="{'{{tab.class}}':tab.class,'highlightedTab':commentMode && tab.highlight}">
            General Details
        </uib-tab-heading>
        <div *ngIf="currentTab === 'general'">
            <cde-de-general-details [elt]="elt"></cde-de-general-details>
        </div>
    </uib-tab>

    <uib-tab ng-repeat="(tabName, tab) in tabs" *ngIf="tab.if?tab.if():true"
             id="{{tabName}}_tab" select="tab.select(tabName)" index="tabName">
        <uib-tab-heading
                ngClass="{'{{tab.class}}':tab.class,'highlightedTab':commentMode && tab.highlight}">
            {{tab.heading}}
        </uib-tab-heading>
        <div *ngIf="tab.includes" ng-repeat="incl in tab.includes">
            <div *ngIf="currentTab == tabName">
                <div ng-include="incl"></div>
            </div>
        </div>
    </uib-tab>
</uib-tabset>
</div>

<div *ngIf="commentMode" ngClass="{'col-sm-3':commentMode,'':!commentMode}"
     style="padding-left:10px;box-shadow: inset 10px 0 5px -2px #888;background-color: #f5f5f5;">
    <cde-discuss-area [selected-elt]="currentTab" [elt-id]="elt.tinyId" [elt]="elt"
                      [elt-name]="elt.naming[0].designation"></cde-discuss-area>
</div>


-->
