<div class="container-fluid">

    <h4 *ngIf='mail.received.length==0 && mail.sent.length==0 && mail.archived.length==0'
        class="centerText">Your Inbox is empty.</h4>

    <h3 *ngIf="mail.received.length > 0">Received</h3>
    <ng-container *ngTemplateOutlet="mailTemplate; context: {type: 'received'}"></ng-container>

    <h3 *ngIf="mail.sent.length > 0">Sent</h3>
    <h3 *ngIf="mail.archived.length > 0">Archived</h3>

    <!--<div ng-repeat="type in [mailTypeReceived, mailTypeSent, mailTypeArchived]" id="mail_{{type}}">-->
        <!--<h3 ng-show="type==mailTypeReceived && mail[type].length>0">Received</h3>-->
        <!--<h3 ng-show="type==mailTypeSent && mail[type].length>0">Sent</h3>-->
        <!--<h3 ng-show="type==mailTypeArchived && mail[type].length>0">Archived</h3>-->

        <!--<div ng-include src="'mailTemplate'"></div>-->
    <!--</div>-->

</div>


<ng-template #mailTemplate let-type>
    <ngb-accordion [closeOthers]="true">
        <div *ngFor="let message of mail[type] | slice:0:20">

            <div *ngIf="message.type === 'CommentReply'">
                <ngb-panel title="">
                    <ng-template ngbPanelTitle>
                        {{message.date | date : medium}} |
                        <!--{{message.type | camelCaseToHuman}} | -->
                        {{message.author.name}} |
                        <!--{{message.typeCommentReply.comment.text | limitTo : 30}}-->
                    </ng-template>
                    <ng-template ngbPanelContent>
                        <dl class="dl-horizontal">
                            <dt>User</dt>
                            <dd>{{message.author.name}}</dd>
                        </dl>
                        <dl class="dl-horizontal">
                            <dt>Reply</dt>
                            <dd>{{message.typeCommentReply.comment.text}}</dd>
                        </dl>
                        <dl class="dl-horizontal">
                            <dt>Element</dt>
                            <dd><a target="_blank" class="linkToElt"
                                   href="/{{message.typeCommentReply.element.eltType==='cde'?'deView':'formView'}}?tinyId={{message.typeCommentReply.element.eltId}}">{{message.typeCommentReply.element.name}}</a></dd>
                        </dl>

                        <span *ngIf="type === mailTypeReceived">
                            <button class="approveComment btn btn-sm btn-default"
                                    (click)="archiveMessage(message)"
                                    [ngClass]="{disabled: message.states[0].action==='Approved'}"
                                    type="button">Archive</button>
                        </span>

                    </ng-template>
                    <!--<div ng-include="'/system/public/html/messages/commentReplyMessage.html'"></div>-->
                    <!--</div>-->
                </ngb-panel>
            </div>

            <!--<div uib-accordion-group class='panel-default' ng-if="message.type === 'MergeRequest'">-->
            <!--<uib-accordion-heading>-->
            <!--{{message.date | date : medium}} | {{message.type | camelCaseToHuman}} |-->
            <!--{{message.typeRequest.destination.object.naming[0].designation}} | {{message.author.name}}-->
            <!--</uib-accordion-heading>-->
            <!--<div ng-include="'/cde/public/html/mergeRequestMessage.html'" ng-init="orgName = orgToManage; page = 'management';"></div>-->
            <!--</div>-->

            <!--<div uib-accordion-group class='panel-default' ng-if="message.type === 'CommentApproval'">-->
            <!--<uib-accordion-heading>-->
            <!--{{message.date | date : medium}} | {{message.type | camelCaseToHuman}} | {{message.author.name}} |-->
            <!--{{message.typeCommentApproval.comment.text | limitTo : 30}}-->
            <!--</uib-accordion-heading>-->
            <!--<div ng-include="'/system/public/html/messages/commentApproval.html'" ng-init="orgName = orgToManage; page = 'management';"></div>-->
            <!--</div>-->

            <!--<div uib-accordion-group class='panel-default' ng-if="message.type === 'AttachmentApproval'">-->
            <!--<uib-accordion-heading>-->
            <!--{{message.date | date : medium}} | {{message.type | camelCaseToHuman}} ( {{message.typeAttachmentApproval.filename}} ) | {{message.author.name}}-->
            <!--</uib-accordion-heading>-->
            <!--<div ng-include="'/system/public/html/attachmentApproval.html'" ng-init="orgName = orgToManage; page = 'management';"></div>-->
            <!--</div>-->

            <!--<div uib-accordion-group class='panel-default' ng-if="message.type === 'BoardApproval'">-->
            <!--<uib-accordion-heading>-->
            <!--{{message.date | date : medium}} | {{message.type | camelCaseToHuman}} | {{message.author.name}}-->
            <!--</uib-accordion-heading>-->
            <!--<div ng-include="'/system/public/html/boardApproval.html'" ng-init="orgName = orgToManage; page = 'management';"></div>-->
            <!--</div>-->
        </div>
    </ngb-accordion>
</ng-template>