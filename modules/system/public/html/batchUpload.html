<div ng-controller="BatchUploadCtrl" ng-blur="tabLostFocus()">

    <div ng-show="loading"><h4 class="pt60 pb40 text-center"><i class="fa fa-spinner fa-pulse"></i> Loading...</h4></div>

    <div ng-if="!loading">
        <div ng-if="!currentBatch">
            <h4>No Batch in progress</h4>
            <button class="btn btn-default" ng-click="initBatch('caDSR')"> Start caDSR Batch</button>
        </div>
        <div ng-if="currentBatch">
            <button class="btn btn-default" ng-click="abortBatch()"> Abort Batch Process</button>

            <hr>

            <h4>{{currentBatch.batchProcess}} Batch in Progress</h4>
            <div><b>Start time: </b> {{currentBatch.startTime}}</div>
            <div><b>Current Step: </b> {{currentBatch.step}}</div>
            <div>{{migrationCdeCount}} cdes in migration</div>

            <hr>

        </div>
    </div>

    <hr>

    <div ng-switch="currentBatch.step">
        <div ng-switch-when="initiated">
            <h4> Next Step - Load Migration Org</h4>
            <textarea ng-model="input.migrationOrg" ng-change="setValid()"/>
            <button ng-disabled="!input.valid" class="btn btn-default" ng-click="loadOrg()"> Load Org</button>
        </div>

        <div ng-switch-when="orgLoaded">
            <h4>Next Step - Load a batch file</h4>
            <input type="file" name="file" id="fileToUpload"
                   onchange="angular.element(this).scope().uploadFile(this.files[0])"/>
            <div ng-bind="$scope.progressPercentage"></div>
        </div>
        <div ng-switch-when="migrationReady">
            <h4>Next Step - Begin Migration</h4>
            <button class="btn btn-default" ng-click="beginMigration()"> Begin Migration</button>
        </div>
    </div>

</div>
