<div ng-controller="CommentsCtrl">
    <br/>
    <div tabindex="0" ng-if="!user._id">Please <a tabindex="0" href="/#/login">log in</a> to comment.</div>
    <div ng-if="user._id">
        <form role="form" name="commentForm" id="commentForm" novalidate>
            <label tabindex="0" class="sr-only" for="commentTextArea">Comments</label>
            <textarea tabindex="0" name="commentTextArea" id="commentTextArea" class="form-control" rows="3"
                      ng-model="comment.content" placeholder="Join the discussion..." required></textarea>
            <input tabindex="0" name="postComment" id="postComment" class="btn btn-primary" type="button"
                   value="Post Comment"
                   ng-click="addComment()" ng-disabled="commentForm.commentTextArea.$invalid"/>
        </form>
    </div>
    <br/>

    <div class="comment" ng-repeat="comment in elt.comments">
        <div class="rootComment">
            <div class="commentBody">
                <div class="commentHeader">
                    <table style="width: 100%;">
                        <tbody>
                        <tr>
                            <td>
                                <div>
                                    <div>
                                        <div>{{comment.username}}</div>
                                        <div>
                                            {{comment.created | date: 'MM/dd/yyyy @ h:mma'}}
                                        </div>

                                    </div>
                                </div>
                            </td>
                            <td>
                                <i class="fa fa-trash-o" title="Remove" id="removeComment-{{$index}}"
                                   ng-show="canRemoveComment(comment)"
                                   ng-click="removeComment(comment._id)" data-type="remove"></i>
                                <i class="fa fa-check-circle-o" title="Resolve" id="resolveComment-{{$index}}"
                                   ng-show="canResolveComment(comment)"
                                   ng-click="updateCommentStatus(comment._id, 'resolved')"></i>
                                <i class="fa fa-undo" title="Reopen" id="reopenComment-{{$index}}"
                                   ng-show="canReopenComment(comment)"
                                   ng-click="updateCommentStatus(comment._id, 'active')"></i>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div id="commentText-{{$index}}" class="commentMessage"
                     ng-class="{strike: comment.status === 'resolved'}">{{comment.text}}
                </div>
            </div>
        </div>
        <div class="reply" ng-repeat="reply in comment.replies" data-type="replyComment">
            <div class="commentHeader">
                <table style="width: 100%;">
                    <tbody>
                    <tr>
                        <td>
                            <div>
                                <div>
                                    <div>{{reply.username}}</div>
                                    <div>
                                        {{reply.created | date: 'MM/dd/yyyy @ h:mma'}}
                                    </div>

                                </div>
                            </div>
                        </td>
                        <td>
                            <i class="fa fa-trash-o" title="Remove" id="removeReply-{{$index}}"
                               ng-show="canRemoveComment(reply)"
                               ng-click="removeComment(reply._id)" data-type="remove"></i>
                            <i class="fa fa-check-circle-o" title="Resolve" id="resolveReply-{{$index}}"
                               ng-show="canResolveComment(reply)"
                               ng-click="updateCommentStatus(reply._id, 'resolved')"
                               data-type="resolve"></i>
                            <i class="fa fa-undo" title="Reopen" id="reopenReply-{{$index}}"
                               ng-show="canReopenComment(reply)"
                               ng-click="updateCommentStatus(reply._id, 'active')"
                               data-type="reopen"></i>

                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div id="replyText-{{$index}}" ng-class="{strike: reply.status === 'resolved'}">{{reply.text}}</div>
        </div>
        <div data-type="reply" class="replyInputDiv">
            <textarea ng-model="comment.tempReply" name="replyTextArea" class="replyInputTextarea" rows="3"
                      placeholder="Reply to this comment" required ng-focus="comment.openReply = true"></textarea>
            <div class="replyInputBtn" ng-show="comment.openReply">
                <button ng-click="replyTo(comment._id, comment.tempReply)"
                        ng-disabled="replyForm.replyTextArea.$invalid">Reply
                </button>
                <button ng-click="comment.openReply = false">Cancel</button>
            </div>
        </div>
    </div>
</div>
