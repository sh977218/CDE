<span ng-controller="SwitchListViewCtrl">

<nav class="navbar navbar-default" id="searchInfo">
    <div class="container-fluid" ng-class="{'noLeftRightPadding':embedded,'pdtp9':!embedded}">
        <div class="navbar-header col-sm-12"
             ng-class="{'col-lg-12 col-md-12 noLeftRightPadding':embedded,'col-lg-7 col-md-10':!embedded}">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <form>
                <label class="sr-only" id="l1" for="ftsearch-input">Search Terms</label>
                <input name="q" id="ftsearch-input" class="search-query col-sm-9 col-xs-7 pdtp9"
                       ng-class="{'col-md-8 col-lg-8':embedded,'col-md-10 col-lg-9':!embedded}"
                       type="text" ng-model="searchSettings.q" ng-maxlength="500" aria-labelledby="l1"
                       autocomplete="off" typeahead-on-select="searchAction()"
                       typeahead-wait-ms="500" typeahead-min-length="3" typeahead-focus-first="false"
                       uib-typeahead="searchQuery for searchQuery in autocomplete.suggest($viewValue) | limitTo:8">
                <div>
                    <button id="search.submit" ng-click="termSearch()" type="submit" class="btn btn-danger noLeftMargin"
                            ng-class="{'btn-sm':embedded,'btn':!embedded}">
                        <i class="fa fa-search"></i> Search
                    </button>
                    <button ng-if="embedded" name="resetSearch" id="resetSearch" class="btn btn-default noLeftMargin"
                            type="button" ng-click="reset()"
                            ng-class="{'btn-sm':embedded,'btn':!embedded}">
                        <i class="fa fa-trash-o"></i> Reset
                    </button>
                </div>
            </form>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse noLeftRightPadding" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav pull-right">
                <li ng-if="!embedded">
                    <button id="pinAll" ng-click="showPinAllModal();" ng-show="totalItems > 0 && user._id"
                            ng-hide="module === 'form'" class="btn btn-default" type="button">
                        <i class="fa fa-thumb-tack hand-cursor"></i> Pin All
                    </button>
                </li>
                <li>
                    <button ng-click="hideShowFilter()" class="btn btn-default  btn-checkbox navbar-btn"
                            id="showHideFilters">
                        <span ng-hide="filterMode"><i class="glyphicon glyphicon-filter"></i> Show Filters</span>
                        <span ng-show="filterMode"><i class="glyphicon glyphicon-filter"></i> Hide Filters</span>
                    </button>
                </li>
                <li ng-if="!embedded">
                    <span ng-include="'/system/public/html/switchListViewControls.html'"></span>
                </li>
                <li ng-if="!embedded">
                    <button ng-if="listViewType === 'accordion'" ng-show="totalItems>0"
                            ng-click="openCloseAllSwitch(elts, 'list');"
                            class="btn btn-default  btn-checkbox navbar-btn" id="openAllCb">
                        <span ng-hide="openCloseAllModel.list"><i class="fa fa-expand"></i> Expand All</span>
                        <span ng-show="openCloseAllModel.list"><i class="fa fa-compress"></i> Collapse All</span>
                    </button>
                </li>
                <li ng-if="!embedded" class="dropdown" ng-controller="ExportCtrl">
                    <button id="export" type="button" class="btn btn-default dropdown-toggle navbar-btn "
                            data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-download"></i> Export<span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right">
                        <li ng-repeat="(key, value) in exporters">
                            <a id="{{value.id}}" ng-click="exportSearchResults(key)" ng-bind="value.display"></a>
                        </li>
                        <li ng-if="displayValidation()">
                            <a id="exportValidRule" ng-click="openValidRulesModal()">Validation Rules</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<div id="searchInfoBar">
    <span tabindex="0" class="pt8 pb8 ib"><strong id="searchResultNum">{{totalItems}}</strong> results for
        <strong>{{currentSearchTerm?currentSearchTerm:'All Terms'}}</strong> |
        <span class="label label-success" id="classif_filter" ng-bind="getSelectedClassifications()"></span>
        <span ng-show="altClassificationFilterMode">and
            <span class="label label-success">{{getSelectedClassificationsAlt()}}
                <i id="removeAltClassificationFilterMode" class="fa fa-times hand-cursor dark-icon pl5"
                   ng-click="toggleAltClassificationFilterMode()" uib-tooltip="Remove this classifications filter"
                   tooltip-popup-delay="500" tooltip-placement="right" tooltip-append-to-body="true">
                </i>
            </span>
        </span>
        | <span class="label label-success" id="topic_crumb" ng-bind="selectedTopicsAsString()"></span>
        | {{getSelectedStatuses()}}
    </span>
    <small> ({{took / 1000}} secs)</small>
</div>
<div class="container-fluid">
    <script type="text/ng-template" id="facet_elements_tree.html">
        <span ng-click="selectElement(e)" class="hand-cursor"
              ng-switch="searchSettings.classification.indexOf(e.name) > -1">
                <i ng-switch-when="true" class="fa fa-angle-down" id="li-checked-{{e.name}}"></i>
                <i ng-switch-when="false" class="fa fa-angle-right" id="li-blank-{{e.name}}"></i>
                <span>
                    <small> {{e.name}} (<span ng-bind="e.count" id="nbOfClassifElts-{{e.name}}"></span>)</small>
                </span>
            </span>
        <div ng-show="selectedElements.indexOf(e.name) > -1" style="margin-left: 5px">
            <div ng-repeat="e in e.elements | orderBy:'name'"
                 ng-show="searchSettings.classification.indexOf(e.name) > -1 || e.level > searchSettings.classification.length"
                 ng-include="'facet_elements_tree.html'"
            >
            </div>
        </div>
    </script>
    <div class="row">
        <div ng-class="{'col-xs-3 col-lg-2' : filterMode===true}" ng-show="filterMode" ng-if="elts.length > 0">
            <p tabindex="0" ng-show="aggregations.orgs.buckets" class="gray">Filter by:</p>
            <div>
                <strong tabindex="0" ng-show="aggregations.orgs.buckets" id="classif_filter_title">Classification
                    <a href tabindex="0" class="nonLinkAnchor" id="altClassificationFilterModeToggle"
                       ng-hide="altClassificationFilterMode || embedded"
                       ng-click="toggleAltClassificationFilterMode()"
                       uib-tooltip="Add a second classifications filter as an AND condition"
                       tooltip-popup-delay="500" tooltip-placement="right" tooltip-append-to-body="true">
                        <i class="fa fa-plus-square hand-cursor"></i></a></strong>
                <div class="pl5" id="classificationListHolder">
                    <a tabindex="0" href class="nonLinkAnchor displayBlock"
                       ng-repeat="t in aggregations.orgs.buckets | orderBy:'key'"
                       ng-switch="t.key === getCurrentSelectedOrg()"
                       ng-click="alterOrgFilter(t.key)"
                       ng-show="t.key === getCurrentSelectedOrg() || !getCurrentSelectedOrg()">
                        <span class="hand-cursor" uib-tooltip="{{t.longName}}" tooltip-popup-delay="500"
                              tooltip-placement="right" tooltip-append-to-body="true">
                            <i ng-switch-when="true" class="fa fa-chevron-down" id="li-checked-{{t.key}}"></i>
                            <i ng-switch-default class="fa fa-chevron-right" id="li-blank-{{t.key}}"></i>
                            <small id="classifications-text-{{t.key}}"> {{t.key}} (<span ng-bind="t.doc_count"
                                                                                         id="nbOfClassifElts-{{t.key}}"></span>)
                            </small>
                        </span>
                    </a>
                    <div id="classification-facets">
                        <a tabindex="0" href class="nonLinkAnchor displayBlock"
                           ng-repeat="e in getCurrentSelectedClassification()"
                           ng-click="selectElement(e)" style="margin-left:{{($index + 1) * 10}}px;">
                            <span class="hand-cursor" ng-switch="getCurrentSelectedClassification().indexOf(e) > -1">
                                <i ng-switch-when="true" class="fa fa-chevron-down" id="li-checked-{{e}}"></i>
                                <i ng-switch-when="false" class="fa fa-chevron-right" id="li-blank-{{e}}"></i>
                                <span>
                                    <small>{{e}}</small>
                                </span>
                            </span>
                        </a>
                        <a tabindex="0" href class="nonLinkAnchor displayBlock" ng-click="selectElement(b.name)"
                           ng-repeat="b in (altClassificationFilterMode?aggregations.flatClassificationsAlt:aggregations.flatClassifications) | orderBy:'name'"
                           style="margin-left:{{(getCurrentSelectedClassification().length + 1) * 10}}px;">
                            <span class="hand-cursor"
                                  ng-switch="getCurrentSelectedClassification().length.indexOf(b.name) > -1">
                                <i ng-switch-when="true" class="fa fa-chevron-down" id="li-checked-{{b.name}}"></i>
                                <i ng-switch-when="false" class="fa fa-chevron-right" id="li-blank-{{b.name}}"></i>
                                <span>
                                    <small>{{b.name}} (<span ng-bind="b.count" id="nbOfClassifElts-{{b.name}}"></span>)
                                    </small>
                                </span>
                            </span>
                        </a>
                    </div>
                </div>
            </div>
            <br/>
            <div> <!-- TOPIC AGGREGATIONS -->
                <strong tabindex="0" ng-show="searchSettings.meshTree.length > 0 || aggregations.topics.length > 0"
                        id="meshTrees_filter">Topics</strong>
                <div class="pl5" id="meshTreesListHolder">
                    <div id="topic-facets">
                        <a tabindex="0" href class="nonLinkAnchor displayBlock"
                           ng-repeat="e in getCurrentSelectedTopic() track by $index"
                           ng-click="selectTopic(e)" style="margin-left:{{($index + 1) * 10}}px;">
                            <span class="hand-cursor" ng-switch="getCurrentSelectedTopic().indexOf(e) > -1">
                                <i ng-switch-when="true" class="fa fa-chevron-down" id="li-checked-{{e}}"></i>
                                <i ng-switch-when="false" class="fa fa-chevron-right" id="li-blank-{{e}}"></i>
                                <span>
                                    <small>{{e}}</small>
                                </span>
                            </span>
                        </a>
                        <a tabindex="0" href class="nonLinkAnchor displayBlock" ng-click="selectTopic(b.name)"
                           ng-repeat="b in aggregations.topics | orderBy:'name'"
                           style="margin-left:{{(getCurrentSelectedTopic().length + 1) * 10}}px;">
                            <span class="hand-cursor"
                                  ng-switch="getCurrentSelectedTopic().length.indexOf(b.name) > -1">
                                <i ng-switch-when="true" class="fa fa-chevron-down" id="li-checked-{{b.name}}"></i>
                                <i ng-switch-when="false" class="fa fa-chevron-right" id="li-blank-{{b.name}}"></i>
                                <span>
                                    <small>{{b.name}} (<span ng-bind="b.count" id="nbOfClassifElts-{{b.name}}"></span>)
                                    </small>
                                </span>
                            </span>
                        </a>
                    </div>
                </div>
            </div>
            <br/>
            <strong tabindex="0" ng-show="aggregations.statuses.statuses.buckets" id="status_filter">Registration
                Status</strong>

            <div class="pl5" id="registrationStatusListHolder">
                    <span class="hand-cursor"
                          ng-repeat="t in aggregations.statuses.statuses.buckets | orderBy : getRegStatusIndex"
                          uib-tooltip-html-unsafe="{{getRegStatusHelp(t.key)}}"
                          tooltip-popup-delay="500" tooltip-placement="right" tooltip-append-to-body="true">
                        <a href class="nonLinkAnchor displayBlock" tabindex="0" ng-if="t.doc_count > 0"
                           style="margin-right: 0" ng-switch="searchSettings.regStatuses.indexOf(t.key) > -1"
                           ng-click="addStatusFilter(t.key)">
                            <i ng-switch-default class="fa fa-square-o" id="li-blank-{{t.key}}"></i>
                            <i ng-switch-when="true" class="fa fa-check-square-o" id="li-checked-{{t.key}}"></i>
                            <small id="status-text-{{t.key}}"> {{t.key}} ({{t.doc_count}})</small>
                        </a>
                    </span>
            </div>
        </div>
        <div id="resultList" ng-class="{'col-xs-9 col-lg-10' : filterMode===true, 'col-xs-12' : filterMode===false}">
            <span ng-hide="elts.length >= 0"><h1 class="pl130"><i class="fa fa-spinner fa-pulse"></i> Searching...</h1></span>
                <span ng-show="elts.length === 0">
                    <h4><i class="fa fa-frown-o"></i> No results were found. Try other criterias or selecting more
                        statuses</h4>
                </span>
            <div ng-if="!embedded" ng-include="viewTypes[listViewType].url"></div>
            <div ng-if="embedded" ng-include="viewTypes.accordion.url"></div>
            <uib-pagination ng-show="totalItems > 0" max-size="10" total-items="totalItems"
                            items-per-page="resultPerPage"
                            ng-model="searchSettings.page" next-text="Next" ng-change="pageChange()"></uib-pagination>
        </div>
    </div>
</div>
</span>