<span ng-controller="SwitchListViewCtrl">
    <div class="container-fluid pt40 pb30">
        <form name="advSearchForm" id="advSearchForm"  ng-submit="submitForm( quickSearchForm.$valid )" novalidate>
            <!-- Search dropdown and text field -->
            <div class="input-group input-group-lg">
                <label class="sr-only" id="l1" for="ftsearch-input">Search Terms</label>
                <input name="ftsearch" id="ftsearch-input" class="form-control search-query" type="text" ng-model="searchForm.ftsearch" ng-maxlength="500" aria-labelledby="l1">
                <div class="input-group-btn">
                    <button name="search.submit" id="search.submit" class="btn btn-danger btn-lg" type="submit" ng-click="search()"><i class="fa fa-search"></i> Search</button>
                    <button name="resetSearch" id="resetSearch" class="btn btn-default btn-lg" type="button" ng-click="resetSearch()"><i class="fa fa-trash-o"></i> Reset</button>
                </div>
            </div>

            <!-- Error display area -->
            <center ng-show="advSearchForm.ftsearch.$invalid && !advSearchForm.ftsearch.$pristine"><p class="error-block"><small>Query terms must be 500 characters or less.</small></p></center>
        </form>
    </div>
    <hr class="searchInfoHr"/>
    <div class="container-fluid searchInfo">
        <span tabindex="0" class="pt8 pb8 ib"><strong>{{totalItems}}</strong> results for <strong>{{currentSearchTerm?currentSearchTerm:'All Terms'}}</strong> | <span class="label label-success" id="classif_filter">{{classificationFilters[0].org?getSelectedClassifications():'All Classifications'}}</span> <span ng-show="altClassificationFilterMode === 1">and <span class="label label-success">{{classificationFilters[1].org?getSelectedClassificationsAlt():'All Classifications'}} <i id="removeAltClassificationFilterMode" class="fa fa-times hand-cursor dark-icon pl5" ng-click="toggleAltClassificationFilterMode()" tooltip="Remove this classifications filter" tooltip-popup-delay="500" tooltip-placement="right" tooltip-append-to-body="true"></i></span></span> | {{getSelectedStatuses()?getSelectedStatuses():'All Statuses'}}</span>

        <span ng-controller="ExportCtrl">
            <a ng-click="exportSearchResults()" ng-show="totalItems>0 && cPage !== 'forms'">
                <button id="exportSearch" value="Export Search" class="btn btn-default pull-right">
                    <i class="fa" ng-class="feedbackClass"></i>
                    Export Search
                </button>
            </a>
        </span>

        <span ng-include="'/template/system/switchListViewControls'"></span>

        <button ng-if="listViewType === 'accordion'" ng-show="totalItems>0" ng-click="openCloseAllSwitch(cdes, 'list');" class="btn btn-default btn-checkbox pull-right" id="openAllCb">
            <span ng-hide="openCloseAllModel.list"><i class="fa fa-expand"></i> Expand All</span>
            <span ng-show="openCloseAllModel.list"><i class="fa fa-compress"></i> Collapse All</span>
        </button>

        <button ng-click="hideShowFilter()" class="btn btn-default btn-checkbox pull-right" id="showHideFilters">
            <span ng-hide="filterMode"><i class="glyphicon glyphicon-filter"></i> Show Filters</span>
            <span ng-show="filterMode"><i class="glyphicon glyphicon-filter"></i> Hide Filters</span>
        </button>
        <button id="pinAll" ng-click="showPinAllModal();" ng-show="totalItems>0 && isOrgCurator() && cPage !== 'forms'" class="btn btn-default btn-checkbox pull-right">
            <i class="fa fa-thumb-tack hand-cursor"></i> Pin All
        </button>

    </div>
    <hr class="searchInfoHr"/>
    <div class="container-fluid pt30">
        <script type="text/ng-template"  id="facet_elements_tree.html">
            <span ng-click="selectElement(e)" class="hand-cursor" ng-switch="classificationFilters[0].elements.indexOf(e.name) > -1">
                <i ng-switch-when="true" class="fa fa-angle-down" id="li-checked-{{e.name}}" ></i>
                <i ng-switch-when="false" class="fa fa-angle-right" id="li-blank-{{e.name}}" ></i>
                <span>
                    <small> {{e.name}} ({{e.count}})</small>
                </span>
            </span>
            <div ng-show="selectedElements.indexOf(e.name) > -1" style="margin-left: 5px">
                <div ng-repeat="e in e.elements | orderBy:'name'"
                    ng-show="classificationFilters[0].elements.indexOf(e.name) > -1 || e.level > classificationFilters[0].elements.length"
                    ng-include="'facet_elements_tree.html'"
                    >
                </div>
            </div>
        </script>
        <div class="row">
            <div ng-class="{'col-xs-3 col-lg-2' : filterMode===true}" ng-show="filterMode">
                <p tabindex="0" ng-show="aggregations.orgs.buckets" class="gray">Filter by:</p>
                <strong tabindex="0" ng-show="aggregations.orgs.buckets" id="classif_filter_title">Classification
                    <a href tabindex="0" class="nonLinkAnchor" id="altClassificationFilterModeToggle" ng-hide="altClassificationFilterMode===1" ng-click="toggleAltClassificationFilterMode()" tooltip="Add a second classifications filter as an AND condition" tooltip-popup-delay="500" tooltip-placement="right" tooltip-append-to-body="true">
                        <i class="fa fa-plus-square hand-cursor" ></i></a></strong>
                <div class="pl5" id="classificationListHolder">
                    <a tabindex="0" href class="nonLinkAnchor displayBlock"
                         ng-repeat="t in aggregations.orgs.buckets | orderBy:'key'"
                         ng-switch="t.key === classificationFilters[altClassificationFilterMode].org"
                         ng-click="addOrgFilter(t)" ng-show="t.key === classificationFilters[altClassificationFilterMode].org || !classificationFilters[altClassificationFilterMode].org">
                        <span class="hand-cursor" tooltip="{{t.longName}}" tooltip-popup-delay="500" tooltip-placement="right" tooltip-append-to-body="true">
                            <i ng-switch-when="true" class="fa fa-chevron-down" id="li-checked-{{t.key}}"></i>
                            <i ng-switch-default class="fa fa-chevron-right" id="li-blank-{{t.key}}" ></i>
                            <small id="classifications-text-{{t.key}}"> {{t.key}} ({{t.doc_count}})</small>
                        </span>
                    </a>
                    <div id="classification-facets">
                        <a tabindex="0" href class="nonLinkAnchor displayBlock" ng-click="selectElement(e)" ng-repeat="e in classificationFilters[altClassificationFilterMode].elements" style="margin-left:{{($index + 1) * 10}}px;">
                            <span class="hand-cursor" ng-switch="classificationFilters[altClassificationFilterMode].elements.indexOf(e) > -1">
                                <i ng-switch-when="true" class="fa fa-chevron-down" id="li-checked-{{e}}" ></i>
                                <i ng-switch-when="false" class="fa fa-chevron-right" id="li-blank-{{e}}" ></i>
                                <span>
                                    <small>{{e}}</small>
                                </span>
                            </span>
                        </a>
                        <a tabindex="0" href class="nonLinkAnchor displayBlock" ng-click="selectElement(b.name)" ng-repeat="b in (altClassificationFilterMode===1 ? aggregations.flatClassificationAlt : aggregations.flatClassification) | orderBy:'name'" style="margin-left:{{(classificationFilters[altClassificationFilterMode].elements.length + 1) * 10}}px;">
                            <span class="hand-cursor" ng-switch="classificationFilters[altClassificationFilterMode].elements.length.indexOf(b.name) > -1">
                                <i ng-switch-when="true" class="fa fa-chevron-down" id="li-checked-{{b.name}}" ></i>
                                <i ng-switch-when="false" class="fa fa-chevron-right" id="li-blank-{{b.name}}" ></i>
                                <span>
                                    <small>{{b.name}} ({{b.count}})</small>
                                </span>
                            </span>
                        </a>
                    </div>
                </div>
                <br/>
                <strong tabindex="0" ng-show="aggregations.statuses.buckets" id="status_filter">Registration Status</strong>
                <div class="pl5" id="registrationStatusListHolder">
                    <a href class="nonLinkAnchor displayBlock" tabindex="0" ng-repeat="t in registrationStatuses" style="margin-right: 0px" ng-switch="t.selected" ng-click="addStatusFilter(t)">
                        <span class="hand-cursor" ng-show="t.count > 0" tooltip-html-unsafe="{{t.help}}" tooltip-popup-delay="500" tooltip-placement="right" tooltip-append-to-body="true">
                            <i ng-switch-default class="fa fa-square-o" id="li-blank-{{t.name}}" ></i>
                            <i ng-switch-when="true" class="fa fa-check-square-o" id="li-checked-{{t.name}}"></i>
                            <small id="status-text-{{t.name}}"> {{t.name}} ({{t.count}})</small>
                        </span>
                    </a>
                </div>
            </div>
            <div ng-class="{'col-xs-9 col-lg-10' : filterMode===true, 'col-xs-12' : filterMode===false}">
                <span ng-hide="cdes.length >= 0"><h1 class="pl130"><i class="fa fa-spinner fa-pulse"></i> Searching...</h1></span>
                <span ng-show="cdes.length === 0"><h4><i class="fa fa-frown-o"></i> No results were found. Try other criterias or selecting more statuses</h4></span>
                <span ng-include="'/template/system/switchListViewContent.ejs'"></span>
                <pagination ng-show="totalItems > 0" max-size="10" total-items="totalItems" items-per-page="20" ng-model="searchForm.currentPage" next-text="Next"></pagination>
            </div>
        </div>
    </div>
</span>