import { dataElementModel } from 'server/cde/mongo-cde';
import { fixDeError } from 'ingester/shared/de';
import { forEach } from 'async';

process.on('unhandledRejection', (error) => {
    console.log(error);
});

function run() {
    let deCount = 0;
    const idsToFix = ['5550d5d744b51dbf50986494', '5550d5e944b51dbf5098649f', '5550d69144b51dbf50986516', '5550d6ea44b51dbf5098654a', '562a721c67fe6c401fc94085', '562a722167fe6c401fc9413d', '562a723067fe6c401fc94390', '562a723667fe6c401fc94441', '562a723667fe6c401fc94442', '562a723667fe6c401fc94443', '562a723667fe6c401fc94444', '562a723867fe6c401fc9448c', '562a723867fe6c401fc9448d', '562a723867fe6c401fc9448e', '562a723867fe6c401fc94492', '562a723867fe6c401fc94493', '562a723867fe6c401fc94494', '562a723f67fe6c401fc9458b', '562a723f67fe6c401fc9458c', '562a724767fe6c401fc946d6', '562a724767fe6c401fc946d7', '562a724867fe6c401fc946d8', '562a724867fe6c401fc946d9', '562a724867fe6c401fc946da', '562a724867fe6c401fc946db', '562a724867fe6c401fc946dc', '562a726c67fe6c401fc94bb0', '562a726d67fe6c401fc94bb9', '562a727167fe6c401fc94c44', '562a727167fe6c401fc94c48', '562a727167fe6c401fc94c49', '562a727967fe6c401fc94d77', '562a727967fe6c401fc94d78', '562a727a67fe6c401fc94d99', '5720f82ecf0f071d07a5f364', '57e3f92705fecd1d300a39be', '5a1454b46385ff7c1d3df8dc', '5a1454b66385ff7c1d3df93a', '5a1454b76385ff7c1d3df98e', '5a1454b76385ff7c1d3df990', '5a1454b76385ff7c1d3df992', '5a1454b76385ff7c1d3df994', '5a1454b76385ff7c1d3df996', '5a1454b76385ff7c1d3df998', '5a1454b76385ff7c1d3df99a', '5a1454b76385ff7c1d3df99c', '5a1454b76385ff7c1d3df99e', '5a1454b76385ff7c1d3df9a0', '5a1454b76385ff7c1d3df9a2', '5a1454b76385ff7c1d3df9a4', '5a1454b76385ff7c1d3df9a6', '5a1454b76385ff7c1d3df9a8', '5a1454b86385ff7c1d3df9aa', '5a1454b86385ff7c1d3df9ac', '5a1454b86385ff7c1d3df9ae', '5a1454b86385ff7c1d3df9b0', '5a1454b86385ff7c1d3df9b2', '5a1454b86385ff7c1d3df9b4', '5a1454b86385ff7c1d3df9b6', '5a1454b86385ff7c1d3df9b8', '5a1454b86385ff7c1d3df9ba', '5a1454b86385ff7c1d3df9bc', '5a1454b86385ff7c1d3df9be', '5a1454b86385ff7c1d3df9c0', '5a1454b86385ff7c1d3df9c2', '5a1454b86385ff7c1d3df9c4', '5a1454b86385ff7c1d3df9c6', '5a1454b86385ff7c1d3df9c8', '5a1454b86385ff7c1d3df9ca', '5a1454b86385ff7c1d3df9cc', '5a1454b86385ff7c1d3df9ce', '5a1454b86385ff7c1d3df9d0', '5a1454b86385ff7c1d3df9d2', '5a1454b86385ff7c1d3df9d4', '5a1454b86385ff7c1d3df9fa', '5a1454b86385ff7c1d3df9fe', '5a1454b86385ff7c1d3dfa00', '5a1454b86385ff7c1d3dfa02', '5a1454b86385ff7c1d3dfa04', '5a1454b86385ff7c1d3dfa06', '5a1454b86385ff7c1d3dfa08', '5a1454b86385ff7c1d3dfa0a', '5a1454b86385ff7c1d3dfa0c', '5a1454b96385ff7c1d3dfa0e', '5a1454b96385ff7c1d3dfa10', '5a1455416385ff7c1d3e2c42', '5a1455576385ff7c1d3e3450', '5a1455576385ff7c1d3e3454', '5ba3f156e1811b23480cefc3', '5ba3f156e1811b23480cefc5', '5ba3f156e1811b23480cefc7', '5ba3f156e1811b23480cefc9', '5ba3f156e1811b23480cefcb', '5ba3f157e1811b23480cefcd', '5ba3f157e1811b23480cefcf', '5ba3f157e1811b23480cefd1', '5ba3f157e1811b23480cefd3', '5ba3f157e1811b23480cefd5', '5ba3f157e1811b23480cefd7', '5ba3f158e1811b23480cefd9', '5ba3f158e1811b23480cefdb', '5ba3f158e1811b23480cefdd', '5ba50404cdf34208c4f3720b', '5ba50430cdf34208c4f37237', '5be49229567d3a14e0125660', '5be49229567d3a14e0125661', '5be4923d567d3a14e012576d', '5be49283567d3a14e0125c0d', '5be49284567d3a14e0125c0e', '5be49293567d3a14e0125d48', '5be49294567d3a14e0125d49', '5be492bd567d3a14e012607e', '5be492bd567d3a14e0126081', '5be492bd567d3a14e0126082', '5be492be567d3a14e0126083', '5be49307567d3a14e0126600', '5be49307567d3a14e0126601', '5be4942b567d3a14e0127c8a', '5be4942b567d3a14e0127c8b', '5be4942f567d3a14e0127ca7', '5be4942f567d3a14e0127ca8', '5be49437567d3a14e0127cde', '5be49437567d3a14e0127cdf', '5be4943e567d3a14e0127d44', '5be4945d567d3a14e0128017', '5be4945d567d3a14e0128018', '5be4946c567d3a14e0128136', '5be4946c567d3a14e0128137', '5be4946f567d3a14e012814b', '5be4946f567d3a14e012814c', '5be49471567d3a14e0128160', '5be49471567d3a14e0128161', '5be4947f567d3a14e0128257', '5be4947f567d3a14e0128258', '5be49480567d3a14e0128268', '5be49481567d3a14e0128269', '5be4948e567d3a14e0128340', '5be494aa567d3a14e012851e', '5be494aa567d3a14e012851f', '5be494c1567d3a14e012870e', '5be494c1567d3a14e012870f', '5be494c1567d3a14e0128710', '5be494c1567d3a14e0128711', '5be494c1567d3a14e0128713', '5be494c1567d3a14e0128714', '5be494c1567d3a14e0128715', '5be494c1567d3a14e0128716', '5be49505567d3a14e0128c97', '5be49506567d3a14e0128c98', '5be4951f567d3a14e0128eb2', '5be4951f567d3a14e0128eb3', '5be4951f567d3a14e0128eb4', '5be4951f567d3a14e0128eb8', '5be4951f567d3a14e0128eb9', '5be4951f567d3a14e0128eba', '5be49520567d3a14e0128ebc', '5be49520567d3a14e0128ebd', '5be49520567d3a14e0128ebe', '5be49520567d3a14e0128ec0', '5be49520567d3a14e0128ec1', '5be49520567d3a14e0128ec2', '5be4953e567d3a14e01290fa', '5be4953e567d3a14e0129100', '5be4953e567d3a14e0129105', '5be4953f567d3a14e012910b', '5be49543567d3a14e012912e', '5be49550567d3a14e01291c3', '5be49550567d3a14e01291c8', '5be49550567d3a14e01291c9', '5be49551567d3a14e01291d7', '5be49551567d3a14e01291dc', '5be49551567d3a14e01291de', '5be4956d567d3a14e01293d3', '5be49570567d3a14e01293e9', '5be49571567d3a14e01293f4', '5be49572567d3a14e01293fb', '5be49573567d3a14e01293ff', '5be49573567d3a14e0129401', '5be49573567d3a14e0129404', '5be49574567d3a14e0129408', '5be49574567d3a14e0129409', '5be4958c567d3a14e0129574', '5be4967f567d3a14e012a864', '5be4967f567d3a14e012a865', '5be4967f567d3a14e012a866', '5be49681567d3a14e012a898', '5be49681567d3a14e012a899', '5be49682567d3a14e012a89e', '5be49682567d3a14e012a89f', '5be496b7567d3a14e012add1', '5be496b8567d3a14e012add2', '5be496bb567d3a14e012ae1e', '5be496c1567d3a14e012ae52', '5be496c9567d3a14e012aeba', '5be496cb567d3a14e012aed1', '5be496cb567d3a14e012aed2', '5be496cc567d3a14e012aeda', '5be496cd567d3a14e012aeef', '5be496cd567d3a14e012aef5', '5be496ce567d3a14e012af03', '5be496e8567d3a14e012b07e', '5be496e8567d3a14e012b080', '5be496ec567d3a14e012b09d', '5be49788567d3a14e012ba5f', '5be49788567d3a14e012ba60', '5be497b5567d3a14e012bda5', '5be497b5567d3a14e012bda6', '5be497b7567d3a14e012bdb7', '5be497b8567d3a14e012bdb8', '5c6323df9b1e59493833b154', '5c6c4637ee3daf158e339f78'];
    console.log(`idsToFix.length: ${idsToFix.length}`);
    forEach(idsToFix, (idToFix, doneOne) => {
        dataElementModel.findById(idToFix, async (err, de) => {
            if (err) {
                throw err;
            } else {
                de.lastMigrationScript = 'mongoose validation';
                await fixDeError(de);
                await de.save().catch(error => {
                    console.log(`await de.save() Error ${error}`);
                });
                deCount++;
                console.log(`deCount: ${deCount}`);
                doneOne();
            }
        });
    }, err => {
        if (err) {
            throw err;
        }
        console.log('finished.');
        process.exit(0);
    });
}

run();
