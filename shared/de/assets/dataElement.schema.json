{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "definitions": {
    "classificationElement": {
      "title": "itemOf_elements",
      "type": "object",
      "properties": {
        "elements": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/classificationElement"
          }
        },
        "name": {
          "type": "string"
        }
      }
    },
    "date": {
      "anyOf": [
        {
          "type": "string",
          "format": "date-time"
        },
        {
          "type": "string",
          "format": "date"
        },
        {
          "type": "object"
        }
      ]
    },
    "objectId": {
      "anyOf": [
        {
          "type": "string",
          "pattern": "^[0-9a-fA-F]{24}$"
        },
        {
          "type": "object"
        }
      ]
    }
  },
  "title": "DataElement",
  "type": "object",
  "properties": {
    "elementType": {
      "type": "string",
      "enum": [
        "cde"
      ],
      "default": "cde"
    },
    "designations": {
      "type": "array",
      "minItems": 1,
      "items": {
        "title": "itemOf_designations",
        "type": "object",
        "properties": {
          "designation": {
            "type": "string",
            "minLength": 1
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "sources": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      },
      "description": "Any string used by which CDE is known, addressed or referred to"
    },
    "definitions": {
      "type": "array",
      "items": {
        "title": "itemOf_definitions",
        "type": "object",
        "properties": {
          "definition": {
            "type": "string"
          },
          "definitionFormat": {
            "type": "string"
          },
          "tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "sources": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "definition"
        ]
      },
      "description": "Description of the CDE"
    },
    "source": {
      "type": "string",
      "description": "This field is replaced with sources"
    },
    "sources": {
      "type": "array",
      "items": {
        "title": "itemOf_sources",
        "type": "object",
        "properties": {
          "sourceName": {
            "type": "string",
            "minLength": 1
          },
          "created": {
            "description": "Date created in source",
            "$ref": "#/definitions/date"
          },
          "updated": {
            "description": "Date updated in source",
            "$ref": "#/definitions/date"
          },
          "registrationStatus": {
            "type": "string",
            "description": "Relative standing of official record status in steward's workflow"
          },
          "datatype": {
            "type": "string",
            "description": "May contain the source datatype"
          },
          "copyright": {
            "title": "copyright",
            "type": "object",
            "properties": {
              "value": {
                "type": "string",
                "description": "Content of a copyright statement or terms of use"
              },
              "valueFormat": {
                "type": "string",
                "description": "If 'html', interpret as HTML"
              }
            }
          }
        },
        "required": [
          "sourceName"
        ]
      },
      "description": "Name of system from which CDE was imported or obtained from"
    },
    "origin": {
      "type": "string",
      "description": "Name of system where CDE is derived"
    },
    "stewardOrg": {
      "title": "stewardOrg",
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of organization or entity responsible for supervising content and administration of CDE",
          "minLength": 1
        }
      },
      "required": [
        "name"
      ]
    },
    "created": {
      "$ref": "#/definitions/date"
    },
    "updated": {
      "$ref": "#/definitions/date"
    },
    "imported": {
      "description": "Date last imported from source",
      "$ref": "#/definitions/date"
    },
    "createdBy": {
      "title": "createdBy",
      "type": "object",
      "properties": {
        "userId": {
          "$ref": "#/definitions/objectId"
        },
        "username": {
          "type": "string"
        }
      }
    },
    "updatedBy": {
      "title": "updatedBy",
      "type": "object",
      "properties": {
        "userId": {
          "$ref": "#/definitions/objectId"
        },
        "username": {
          "type": "string"
        }
      }
    },
    "tinyId": {
      "type": "string",
      "description": "Internal CDE identifier"
    },
    "version": {
      "type": "string"
    },
    "dataElementConcept": {
      "title": "dataElementConcept",
      "type": "object",
      "properties": {
        "concepts": {
          "type": "array",
          "items": {
            "title": "itemOf_concepts",
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "origin": {
                "type": "string",
                "description": "Source of concept"
              },
              "originId": {
                "type": "string",
                "description": "Identifier of concept from source"
              }
            }
          }
        },
        "conceptualDomain": {
          "title": "conceptualDomain",
          "type": "object",
          "properties": {
            "vsac": {
              "title": "vsac",
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "name": {
                  "type": "string"
                },
                "version": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "objectClass": {
      "title": "objectClass",
      "type": "object",
      "properties": {
        "concepts": {
          "type": "array",
          "items": {
            "title": "itemOf_concepts",
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "origin": {
                "type": "string",
                "description": "Source of concept"
              },
              "originId": {
                "type": "string",
                "description": "Identifier of concept from source"
              }
            }
          }
        }
      }
    },
    "property": {
      "title": "property",
      "type": "object",
      "properties": {
        "concepts": {
          "type": "array",
          "items": {
            "title": "itemOf_concepts",
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "origin": {
                "type": "string",
                "description": "Source of concept"
              },
              "originId": {
                "type": "string",
                "description": "Identifier of concept from source"
              }
            }
          }
        }
      }
    },
    "valueDomain": {
      "title": "valueDomain",
      "type": "object",
      "properties": {
        "name": {
          "type": ["string", "null"]
        },
        "identifiers": {
          "type": "array",
          "items": {
            "title": "itemOf_identifiers",
            "type": "object",
            "properties": {
              "source": {
                "type": "string"
              },
              "id": {
                "type": "string"
              },
              "version": {
                "type": "string"
              }
            }
          }
        },
        "ids": {
          "type": "array",
          "items": {
            "title": "itemOf_ids",
            "type": "object",
            "properties": {
              "source": {
                "type": "string"
              },
              "id": {
                "type": "string"
              },
              "version": {
                "type": "string"
              }
            }
          }
        },
        "definition": {
          "type": ["string", "null"]
        },
        "uom": {
          "description": "Unit of Measure",
          "type": ["string", "null"]
        },
        "vsacOid": {
          "type": ["string", "null"]
        },
        "datatype": {
          "type": "string",
          "description": "Expected type of data"
        },
        "datatypeText": {
          "title": "datatypeText",
          "type": "object",
          "properties": {
            "minLength": {
              "type": "number",
              "description": "To indicate limits on length"
            },
            "maxLength": {
              "type": "number",
              "description": "To indicate limits on length"
            },
            "regex": {
              "type": "string",
              "description": "To indicate a regular expression that someone may want to match on"
            },
            "rule": {
              "type": "string",
              "description": "Any rule may go here"
            },
            "showAsTextArea": {
              "type": "boolean",
              "default": false,
              "description": "Multi-line"
            }
          }
        },
        "datatypeNumber": {
          "title": "datatypeNumber",
          "type": "object",
          "properties": {
            "minValue": {
              "type": "number"
            },
            "maxValue": {
              "type": "number"
            },
            "precision": {
              "type": "number",
              "description": "Any precision for this number. Typically an integer for a float. Limit to 10^precision"
            }
          }
        },
        "datatypeDate": {
          "title": "datatypeDate",
          "type": "object",
          "properties": {
            "precision": {
              "type": "string",
              "enum": [
                "Year",
                "Month",
                "Day",
                "Hour",
                "Minute",
                "Second"
              ],
              "default": "Day"
            }
          }
        },
        "datatypeTime": {
          "title": "datatypeTime",
          "type": "object",
          "properties": {
            "format": {
              "type": "string",
              "description": "Any format that someone may want to enforce"
            }
          }
        },
        "datatypeExternallyDefined": {
          "title": "datatypeExternallyDefined",
          "type": "object",
          "properties": {
            "link": {
              "type": "string",
              "description": "A link to an external source. Typically a URL"
            },
            "description": {
              "type": "string"
            },
            "descriptionFormat": {
              "type": "string",
              "description": "if 'html', then parse with HTML"
            }
          }
        },
        "datatypeValueList": {
          "title": "datatypeValueList",
          "type": "object",
          "properties": {
            "datatype": {
              "type": "string",
              "description": "Value list format"
            }
          }
        },
        "permissibleValues": {
          "type": "array",
          "items": {
            "title": "itemOf_permissibleValues",
            "type": "object",
            "properties": {
              "permissibleValue": {
                "type": "string"
              },
              "valueMeaningName": {
                "type": "string"
              },
              "valueMeaningCode": {
                "type": "string"
              },
              "valueMeaningDefinition": {
                "type": "string"
              },
              "codeSystemName": {
                "type": "string"
              },
              "codeSystemVersion": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "history": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/objectId"
      }
    },
    "changeNote": {
      "description": "Description of last modification",
      "anyOf": [
        {"type": "string"},
        {"type": "null"}
      ]
    },
    "lastMigrationScript": {
      "type": "string",
      "description": "Internal use only"
    },
    "registrationState": {
      "title": "registrationState",
      "type": "object",
      "properties": {
        "registrationStatus": {
          "type": "string",
          "enum": [
            "Preferred Standard",
            "Standard",
            "Qualified",
            "Recorded",
            "Candidate",
            "Incomplete",
            "Retired"
          ]
        },
        "effectiveDate": {
          "anyOf": [
            {
              "$ref": "#/definitions/date"
            },
            {
              "type": "null"
            }
          ]
        },
        "untilDate": {
          "anyOf": [
            {
              "$ref": "#/definitions/date"
            },
            {
              "type": "null"
            }
          ]
        },
        "administrativeNote": {
          "type": "string"
        },
        "unresolvedIssue": {
          "type": "string"
        },
        "administrativeStatus": {
          "type": "string",
          "description": "Relative standing of CDE as it relates to steward's administrative workflow"
        },
        "replacedBy": {
          "title": "replacedBy",
          "type": "object",
          "properties": {
            "tinyId": {
              "type": "string",
              "description": "tinyId of replacement CDE"
            }
          }
        }
      },
      "required": [
        "registrationStatus"
      ]
    },
    "classification": {
      "type": "array",
      "items": {
        "title": "itemOf_classification",
        "type": "object",
        "properties": {
          "stewardOrg": {
            "title": "stewardOrg",
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "minLength": 1
              }
            },
            "required": [
              "name"
            ]
          },
          "workingGroup": {
            "type": "boolean"
          },
          "elements": {
            "type": "array",
            "minItems": 1,
            "items": {
              "$ref": "#/definitions/classificationElement"
            }
          }
        },
        "required": [
          "elements",
          "stewardOrg"
        ]
      },
      "description": "Organization or categorization by Steward Organization"
    },
    "properties": {
      "type": "array",
      "items": {
        "title": "itemOf_properties",
        "type": "object",
        "properties": {
          "key": {
            "type": "string",
            "minLength": 1
          },
          "value": {
            "type": "string",
            "minLength": 1
          },
          "source": {
            "type": "string"
          },
          "valueFormat": {
            "type": "string",
            "enum": [
              "html",
              ""
            ]
          }
        },
        "required": [
          "key",
          "value"
        ]
      },
      "description": "Attribute not otherwise documented by structured CDE record"
    },
    "ids": {
      "type": "array",
      "items": {
        "title": "itemOf_ids",
        "type": "object",
        "properties": {
          "source": {
            "type": "string",
            "minLength": 1
          },
          "id": {
            "type": "string",
            "minLength": 1
          },
          "version": {
            "type": "string"
          }
        },
        "required": [
          "id",
          "source"
        ]
      },
      "description": "Identifier used to establish or indicate what CDE is within a specific context"
    },
    "dataSets": {
      "type": "array",
      "items": {
        "title": "itemOf_dataSets",
        "type": "object",
        "properties": {
          "source": {
            "type": "string"
          },
          "id": {
            "type": "string"
          },
          "studyUri": {
            "type": "string"
          },
          "notes": {
            "type": "string"
          }
        }
      },
      "description": "A list of datasets that use this CDE"
    },
    "archived": {
      "type": "boolean",
      "default": false,
      "description": "Indication of historical record. True for previous versions."
    },
    "forkOf": {
      "type": "string",
      "description": "May point to a tinyID if the CDE is a fork"
    },
    "attachments": {
      "type": "array",
      "items": {
        "title": "itemOf_attachments",
        "type": "object",
        "properties": {
          "fileid": {
            "type": "string"
          },
          "filename": {
            "type": "string"
          },
          "filetype": {
            "type": "string"
          },
          "uploadDate": {
            "$ref": "#/definitions/date"
          },
          "comment": {
            "type": "string"
          },
          "uploadedBy": {
            "title": "uploadedBy",
            "type": "object",
            "properties": {
              "userId": {
                "$ref": "#/definitions/objectId"
              },
              "username": {
                "type": "string"
              }
            }
          },
          "filesize": {
            "type": "number"
          },
          "isDefault": {
            "type": "boolean"
          },
          "pendingApproval": {
            "type": "boolean"
          },
          "scanned": {
            "type": "boolean"
          }
        }
      }
    },
    "views": {
      "type": "number",
      "default": 0
    },
    "referenceDocuments": {
      "type": "array",
      "items": {
        "title": "itemOf_referenceDocuments",
        "type": "object",
        "properties": {
          "docType": {
            "type": "string"
          },
          "document": {
            "type": "string"
          },
          "referenceDocumentId": {
            "type": "string"
          },
          "text": {
            "type": "string"
          },
          "uri": {
            "type": "string"
          },
          "providerOrg": {
            "type": "string"
          },
          "title": {
            "type": "string"
          },
          "languageCode": {
            "type": "string"
          },
          "source": {
            "type": "string"
          }
        }
      },
      "description": "Any written, printed or electronic matter used as a source of information. Used to provide information or evidence of authoritative or official record."
    },
    "derivationRules": {
      "type": "array",
      "items": {
        "title": "itemOf_derivationRules",
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "inputs": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Information operated on by rule"
          },
          "outputs": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Information produced by rule"
          },
          "ruleType": {
            "type": "string",
            "enum": [
              "score",
              "panel"
            ]
          },
          "formula": {
            "type": "string",
            "enum": [
              "sumAll",
              "mean",
              "bmi"
            ]
          },
          "_id": {
            "$ref": "#/definitions/objectId"
          }
        }
      }
    },
    "_id": {
      "$ref": "#/definitions/objectId"
    },
    "__v": {
      "type": "number"
    }
  },
  "required": [
    "registrationState",
    "stewardOrg"
  ]
}
