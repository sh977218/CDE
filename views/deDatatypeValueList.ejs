<hr/>
<h4>Permissible Values</h4>
<div><button ng-show="showValidateButton" ng-click="runManualValidation()">Validate</button></div>
<div ng-show="cde.valueDomain.permissibleValues.length == 0">No Permissible Values</div>
<table ng-show="cde.valueDomain.permissibleValues.length > 0" class="table-bordered table-condensed table-striped" summary="List of permissible values">
     <thead>
         <tr>
             <th id="name">Name</th>
             <th id="codeName">Code Name</th>
             <th id="code">Code</th>
             <th id="codeSystem">Code System</th>
             <th id="validation" ng-show="detailedView">Valid</th>
             <th id="actions" ng-show="isAllowed(cde)">Actions</th>
         </tr>
     </thead>
     <tbody>
         <tr id="pv-{{$index}}" ng-repeat="pv in cde.valueDomain.permissibleValues">
             <td headers="name" id="pv-{{$index}}"><inline-edit model="pv.permissibleValue" is-allowed="isAllowed(cde)" on-ok="stageCde(cde)"> </inline-edit></td>
             <td headers="codeName" id="pvName-{{$index}}">
                 <div>
                     <div ng-hide="editMode"> 
                         {{pv.valueMeaningName}} <i ng-show="canLinkPv" class="fa fa-link" ng-click="editMode=true"></i> 
                     </div>
                     <div ng-show="editMode">
                         <input type="text" ng-model="pv.valueMeaningName" typeahead="code.displayName for code in vsacValueSet | filter:$viewValue | limitTo:8"/>
                         <a class="fa fa-check" ng-click="editMode = false; attachPv(pv)" title="OK" href=""></a>
                         <a class="fa fa-times" ng-click="editMode = false" title="Cancel" href=""></a>
                     </div>      
                 </div>
             </td>
             <td headers="code" id="pvCode-{{$index}}">{{pv.valueMeaningCode}}</td>
             <td headers="codeSystem">{{pv.codeSystemName}}</td>
             <td headers="validation" ng-show="detailedView">
                 <span ng-switch="pv.isValid">
                     <i ng-switch-when="true" class="fa fa-check text-success" id="pv-{{$index}}-valid"></i>
                     <i ng-switch-default class="fa fa-exclamation text-warning" id="pv-{{$index}}-warning"></i>
                 </span>
             </td>
             <td headers="actions" ng-show="isAllowed(cde)">
                 <a id="pvUp-{{$index}}" class="btn-mini fa fa-arrow-up" ng-click="movePvUp($index)" ng-hide="$first" title="Up" href=""></a>
                 <a id="pvDown-{{$index}}" class="btn-mini fa fa-arrow-down" ng-click="movePvDown($index)" ng-hide="$last" title="Down" href=""></a>
                 <a id="pvRemove-{{$index}}" class="btn-mini fa fa-trash-o" ng-click="removePv($index)" title="Remove" href=""></a>
             </td>
         </tr>
         <tr ng-show="cde.valueDomain.permissibleValues.length == 10">
             <td colspan="3">See full list in Detailed View</td>
         </tr>
     </tbody>
 </table>
<a class="btn btn-small btn-default" ng-show="isAllowed(cde)" ng-click="addPv()"><i id="addPv" class="fa fa-plus"></i> Add Permissible Value</a>
<a class="btn btn-small btn-default" ng-show="isAllowed(cde)" ng-click="removeAllPvs()"><i id="removeAllPvs" class="fa fa-trash-o"></i> Remove All Values</a>
<hr/>
<div ng-show="detailedView">
<h4>VSAC Value Set</h4>
<dl class="dl-horizontal" ng-show="cde.dataElementConcept.conceptualDomain.vsac">
    <dt>Value Set Name: </dt><dd>{{cde.dataElementConcept.conceptualDomain.vsac.name | placeholdEmpty}}</dd>
    <dt>Value Set ID: </dt><dd>{{cde.dataElementConcept.conceptualDomain.vsac.id | placeholdEmpty}}</dd>
    <dt>Value Set Version: </dt><dd>{{cde.dataElementConcept.conceptualDomain.vsac.version | placeholdEmpty}}</dd>
</dl>
<div ng-hide="cde.dataElementConcept.conceptualDomain.vsac">No Value Set specified.</div>
<div ng-controller="SaveCdeCtrl">
    <div>{{vsacError}}</div>
    <div ng-hide="editMode">
        <a class="btn btn-default" ng-show="isAllowed(cde)" ng-click="editMode=true">Update O.I.D</a>
        <a class="btn btn-default" ng-show="isAllowed(cde) && cde.dataElementConcept.conceptualDomain.vsac" ng-click="removeVSMapping()" id="removeVSButton">Remove Mapping</a>
    </div> 
    <div ng-show="editMode">
        <input name="vsacId" type="text" ng-model="cde.dataElementConcept.conceptualDomain.vsac.id" placeholder="VSAC O.I.D"/>
        <i id="vsacIdCheck" class="fa fa-check" ng-click="checkVsacId(cde); loadValueSet(); editMode = false"></i>
        <i class="fa fa-times" ng-click="editMode = false"></i>
    </div>
</div>
<hr/>
<table ng-show="cde.dataElementConcept.conceptualDomain.vsac.id" class="table-bordered table-condensed table-striped">
     <thead>
         <tr>
             <th>Code Name</th>
             <th>Code</th>
             <th>Code System</th>
             <th id="validation">Valid</th>
             <th ng-show="isAllowed(cde)">Actions</th>
         </tr>
     </thead> 
     <tbody id="vsacTableBody">
         <tr ng-repeat="con in vsacValueSet">
             <td>{{con.displayName}}</td>
             <td>{{con.code}}</td>
             <td>{{con.codeSystemName}}</td>
             <td headers="validation">
                 <span ng-switch="con.isValid">
                     <i ng-switch-when="true" class="fa fa-check text-success" id="vset-{{$index}}-valid"></i>
                     <i ng-switch-default class="fa fa-exclamation text-warning" id="vset-{{$index}}-warning"></i>
                 </span>
             </td>
             <td ng-show="isAllowed(cde)">
                 <i ng-click="addVsacValue(con)" ng-show="!isVsInPv(con)" class="fa fa fa-plus"></i>
             </td>
         </tr>
     </tbody>
</table>
</div>
