<pagination data-boundary-links="true" num-pages="numPages" current-page="currentPage" max-size="10"></pagination>

<form class="form-search">
<input type="text" ng-model="search.longName" class="search-query" placeholder="Search Name" typeahead="cde.longName for cde in autocomplete($viewValue)" >
<select ng-model="search.owningContext" name="owningContext" >
    <option value="">All Contexts</option>
    <option ng-repeat="context in contexts" ng-value="context">{{context}}</option>    
</select>
<input type="submit" value="Search" ng-click="reload()" class="btn"></input>
</form>

<accordion>
    <accordion-group ng-repeat="cde in cdes" heading="{{cde.owningContext}} -- {{cde.longName}}">
         <div class="row-fluid">
            <div class="span5">
                <h4>General Details</h4>
                <dl class="dl-horizontal">
                <dt>Name: </dt> <dd><inline-edit model="cde.longName" is-allowed="isAllowed(cde)" on-ok="stageCde(cde)"> </inline-edit></dd>
                <dt>Origin: </dt><dd>{{cde.origin}}</dd>
                <dt>Origin ID: </dt><dd>{{cde.originId}}</dd>
                <dt>Owner: </dt><dd>{{cde.owningContext}}</dd>
                <dt>Definition: </dt><dd><inline-area-edit model="cde.preferredDefinition" is-allowed="isAllowed(cde)" on-ok="stageCde(cde)"> </inline-area-edit></dd>
                <dt>Added to NLM: </dt>
                <dd ng-controller="AuditCtrl" >
                    <i ng-show="cde.history.length > 0" class="icon-eye-open" ng-click="openHistory()" tooltip="View History"></i> {{cde.created | date: 'MM/dd/yyyy @ h:mma'}}
                    <%- include historyModal.ejs %>
                </dd>
                <dt>Updated in NLM: </dt><dl>{{cde.updated | date: 'MM/dd/yyyy @ h:mma'}}</dl>
                </dl>
            </div>
             <div class="span3">
                 <h4>Concepts</h4>
                 <table class="table-bordered table-condensed table-striped">
                     <thead>
                         <tr>
                             <th>Name</th>
                             <th>Origin</th>
                             <th>Origin ID</th>
                         </tr>
                     </thead>
                     <tbody>
                         <tr ng-repeat="concept in cde.objectClass.concepts">
                             <td>{{concept.name}}</td>
                             <td>{{concept.origin}}</td>
                             <td>{{concept.originId}}</td>
                         </tr>
                         <tr ng-repeat="concept in cde.property.concepts">
                             <td>{{concept.name}}</td>
                             <td>{{concept.origin}}</td>
                             <td>{{concept.originId}}</td>
                         </tr>
                     </tbody>
                 </table>
             </div>
            <div class="span4">
                <h4>Permissible Values</h4>
                <%- include valueDomainView.ejs %>
            </div>
          </div>
        <div class="row-fluid" ng-controller="AddToFormCtrl">
            <span class="dropdown">
                <a class="btn-small btn-primary" ng-click="openModal()"><i class="icon-list-alt"> Add to Form</i></a>
                <%- include addToFormModal.ejs %> 
            </span>
        </div>
        <div class="row">
            <div ng-controller="SaveCtrl">
            <div class="span12" ng-show="cde.unsaved">
                <button class="btn cancel" ng-click="revert(cde)">Discard Changes</button>
                <button class="btn btn-primary" ng-click="openSave()">Save</button>
            </div>
            <div modal="showSave" close="closeSave()" opts="saveOpts">
                <div class="modal-header">
                    <h4>Save</h4>
                </div>
                <div class="modal-body">
                    <label for="changeNote">Change Note</label>
                    <textArea name="changeNote" ng-model="cde.changeNote" placeholder="Optional Change Note"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn cancel" ng-click="cancelSave()">Cancel</button>
                    <button class="btn btn-warning" ng-click="save(cde); showSave = false">Save</button>
                </div>
            </div>
            </div>
        </div>
    </accordion-group>
</accordion>
